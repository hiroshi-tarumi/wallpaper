YUI.add("hermes-template-photo-list-photo-edit-interaction",(function(n,t){var l=n.Template.Handlebars.revive({1:function(n,t,l,e,a){var o,i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression(n.lambda(null!=(o=null!=t?i(t,"photo"):t)?i(o,"title"):o,t))},3:function(n,t,l,e,a){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.UNTITLED"},data:a,loc:{start:{line:3,column:141},end:{line:3,column:183}}}))},5:function(n,t,l,e,a){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return" "+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.BY_YOU"},data:a,loc:{start:{line:3,column:212},end:{line:3,column:252}}}))},7:function(n,t,l,e,a){var o,i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return" "+n.escapeExpression((i(l,"intlMessage")||t&&i(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{user:null!=(o=null!=(o=null!=t?i(t,"photo"):t)?i(o,"owner"):o)?i(o,"username"):o,intlName:"common.BY_USER"},data:a,loc:{start:{line:3,column:261},end:{line:3,column:328}}}))},9:function(n,t,l,e,a){return" hidden"},11:function(n,t,l,e,a){var o,i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<span class="icon-count">'+n.escapeExpression("function"==typeof(o=null!=(o=i(l,"viewCount")||(null!=t?i(t,"viewCount"):t))?o:n.hooks.helperMissing)?o.call(null!=t?t:n.nullContext||{},{name:"viewCount",hash:{},data:a,loc:{start:{line:15,column:72},end:{line:15,column:85}}}):o)+"</span>"},13:function(n,t,l,e,a){var o,i=null!=t?t:n.nullContext||{},s=n.hooks.helperMissing,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<div class="tool like-area" aria-label="'+n.escapeExpression((r(l,"intlMessage")||t&&r(t,"intlMessage")||s).call(i,{name:"intlMessage",hash:{countString:(r(l,"formatNumber")||t&&r(t,"formatNumber")||s).call(i,null!=t?r(t,"likeCount"):t,{name:"formatNumber",hash:{},data:a,loc:{start:{line:19,column:116},end:{line:19,column:140}}}),count:null!=t?r(t,"likeCount"):t,intlName:"likes.LIKES_COUNT"},data:a,loc:{start:{line:19,column:45},end:{line:19,column:142}}}))+'" tabindex="0">\n\t\t\t\t\t\t<svg class="icon icon-like"><use xlink:href="#icon-like"></use></svg>\n\t\t\t\t\t\t'+(null!=(o=r(l,"if").call(i,null!=t?r(t,"likeCount"):t,{name:"if",hash:{},fn:n.program(14,a,0),inverse:n.noop,data:a,loc:{start:{line:21,column:6},end:{line:21,column:88}}}))?o:"")+"\n\t\t\t\t\t</div>\n"},14:function(n,t,l,e,a){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<span class="icon-count">'+n.escapeExpression((o(l,"formatNumber")||t&&o(t,"formatNumber")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},null!=t?o(t,"likeCount"):t,{name:"formatNumber",hash:{},data:a,loc:{start:{line:21,column:48},end:{line:21,column:74}}}))+"</span>"},16:function(n,t,l,e,a){var o,i=null!=t?t:n.nullContext||{},s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<div class="tool fave-area" aria-label="'+n.escapeExpression((s(l,"intlMessage")||t&&s(t,"intlMessage")||n.hooks.helperMissing).call(i,{name:"intlMessage",hash:{num:null!=t?s(t,"faveCount"):t,intlName:"stats.NUMBER_FAVES"},data:a,loc:{start:{line:24,column:45},end:{line:24,column:104}}}))+'" tabindex="0">\n\t\t\t\t\t\t<i class="fave-icon"></i>'+(null!=(o=s(l,"if").call(i,null!=t?s(t,"faveCount"):t,{name:"if",hash:{},fn:n.program(17,a,0),inverse:n.noop,data:a,loc:{start:{line:25,column:31},end:{line:25,column:100}}}))?o:"")+"\n\t\t\t\t\t</div>\n"},17:function(n,t,l,e,a){var o,i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<span class="icon-count">'+n.escapeExpression("function"==typeof(o=null!=(o=i(l,"faveCount")||(null!=t?i(t,"faveCount"):t))?o:n.hooks.helperMissing)?o.call(null!=t?t:n.nullContext||{},{name:"faveCount",hash:{},data:a,loc:{start:{line:25,column:73},end:{line:25,column:86}}}):o)+"</span>"},19:function(n,t,l,e,a){var o,i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<span class="icon-count">'+n.escapeExpression("function"==typeof(o=null!=(o=i(l,"commentCount")||(null!=t?i(t,"commentCount"):t))?o:n.hooks.helperMissing)?o.call(null!=t?t:n.nullContext||{},{name:"commentCount",hash:{},data:a,loc:{start:{line:30,column:78},end:{line:30,column:94}}}):o)+"</span>"},compiler:[8,">= 4.3.0"],main:function(n,t,l,e,a){var o,i,s=null!=t?t:n.nullContext||{},r=n.hooks.helperMissing,c="function",u=n.escapeExpression,p=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="photo-list-photo-edit-interaction">\n\t<a class="overlay" href="'+u(typeof(i=null!=(i=p(l,"photoPageUrl")||(null!=t?p(t,"photoPageUrl"):t))?i:r)===c?i.call(s,{name:"photoPageUrl",hash:{},data:a,loc:{start:{line:3,column:26},end:{line:3,column:42}}}):i)+'" tabindex="0" role="heading" aria-level="3" aria-label="'+(null!=(o=p(l,"if").call(s,null!=(o=null!=t?p(t,"photo"):t)?p(o,"title"):o,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.program(3,a,0),data:a,loc:{start:{line:3,column:99},end:{line:3,column:190}}}))?o:"")+(null!=(o=p(l,"if").call(s,null!=(o=null!=t?p(t,"photo"):t)?p(o,"isOwner"):o,{name:"if",hash:{},fn:n.program(5,a,0),inverse:n.program(7,a,0),data:a,loc:{start:{line:3,column:190},end:{line:3,column:335}}}))?o:"")+'"></a>\n\t<button class="extra-tool'+(null!=(o=p(l,"if").call(s,null!=t?p(t,"isMobileOrTablet"):t,{name:"if",hash:{},fn:n.noop,inverse:n.program(9,a,0),data:a,loc:{start:{line:4,column:26},end:{line:4,column:64}}}))?o:"")+' remove-photo remove-own-photo" data-id='+u(n.lambda(null!=(o=null!=t?p(t,"photo"):t)?p(o,"id"):o,t))+' tabindex="0" aria-label="'+u((p(l,"intlMessage")||t&&p(t,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.DELETE_PHOTO"},data:a,loc:{start:{line:4,column:142},end:{line:4,column:200}}}))+'"></button>\n\t<div class="interaction-bar">\n\t\t'+u((p(l,"outlet")||t&&p(t,"outlet")||r).call(s,null!=t?p(t,"sub-photo-title-desc-view"):t,{name:"outlet",hash:{},data:a,loc:{start:{line:6,column:2},end:{line:6,column:38}}}))+'\n\t\t<div class="tools" tabindex="-1">\n\t\t\t<div class="tool privacy-area" tabindex="0" aria-label="'+u((p(l,"intlMessage")||t&&p(t,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:"common.PRIVACY"},data:a,loc:{start:{line:8,column:59},end:{line:8,column:100}}}))+'" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t<i class="privacy-icon '+u(typeof(i=null!=(i=p(l,"privacy")||(null!=t?p(t,"privacy"):t))?i:r)===c?i.call(s,{name:"privacy",hash:{},data:a,loc:{start:{line:9,column:27},end:{line:9,column:38}}}):i)+'"></i>\n\t\t\t\t<span class="down-caret"></span>\n\t\t\t</div>\n\n\t\t\t<div class="tools" tabindex="-1">\n\t\t\t\t<div class="tool view-area" aria-label="'+u((p(l,"intlMessage")||t&&p(t,"intlMessage")||r).call(s,{name:"intlMessage",hash:{num:null!=t?p(t,"viewCount"):t,intlName:"stats.NUMBER_VIEWS"},data:a,loc:{start:{line:14,column:44},end:{line:14,column:103}}}))+'" tabindex="0">\n\t\t\t\t\t<i class="view-icon"></i>'+(null!=(o=p(l,"if").call(s,null!=t?p(t,"viewCount"):t,{name:"if",hash:{},fn:n.program(11,a,0),inverse:n.noop,data:a,loc:{start:{line:15,column:30},end:{line:15,column:99}}}))?o:"")+"\n\t\t\t\t</div>\n\n"+(null!=(o=(p(l,"isFlipped")||t&&p(t,"isFlipped")||r).call(s,"enable-likes",{name:"isFlipped",hash:{},fn:n.program(13,a,0),inverse:n.program(16,a,0),data:a,loc:{start:{line:18,column:4},end:{line:27,column:18}}}))?o:"")+'\n\t\t\t\t<div class="tool comment-area" aria-label="'+u((p(l,"intlMessage")||t&&p(t,"intlMessage")||r).call(s,{name:"intlMessage",hash:{num:null!=t?p(t,"commentCount"):t,intlName:"stats.NUMBER_COMMENTS"},data:a,loc:{start:{line:29,column:47},end:{line:29,column:112}}}))+'" tabindex="0">\n\t\t\t\t\t<i class="comment-icon"></i>'+(null!=(o=p(l,"if").call(s,null!=t?p(t,"commentCount"):t,{name:"if",hash:{},fn:n.program(19,a,0),inverse:n.noop,data:a,loc:{start:{line:30,column:33},end:{line:30,column:108}}}))?o:"")+"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n"},useData:!0}),e={};n.Array.each([],(function(t){var l=n.Template.get("hermes/"+t);l&&(e[t]=l)})),n.Template.register("hermes/photo-list-photo-edit-interaction",(function(t,a){return(a=a||{}).partials=a.partials?n.merge(e,a.partials):e,l(t,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-list-photo-edit-interaction-view",(function(e,t){var i=require("hermes-core/type-validator"),n=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),e.photoPageUrl&&this.set("photoPageUrl",e.photoPageUrl),e.photoId=e.id,this.nsid=this.appContext.getViewer().nsid,this},subviewConfig:{"sub-photo-title-desc-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["photostream-edit"]}},loadState:function(){var t=[],i=this.get("listModelParams"),n=this;return t.push(this.appContext.getModel(this.get("engagementModelName"),this.get("id"))),t.push(this.appContext.getModel("photo-privacy-models",this.get("id"))),i&&t.push(this.appContext.getModel(i.registryName,i.modelIdOrAttributes)),e.Promise.all(t).then((function(e){n.set("engagement",e[0]),n.set("privacy",e[1])}))},buildContainer:function(t){var i,n=this.get("engagement"),a=n.getValue("faveCount"),o=n.getValue("commentCount"),r=n.getValue("viewCount");return this.privacyString=e.PrivacyHelper.mapPrivacy(this.get("privacy").toJSON()),(t=t||{}).photo=this.get("model").toJSON(),t.photoPageUrl=this.get("photoPageUrl"),t.viewCount=r,t.privacy=this.privacyString,t.isMobileOrTablet=this.appContext.getUA().isMobileOrTablet,t.faveCount=e.IntlNumber.format(a,this.appContext.lang,1),t.commentCount=e.IntlNumber.format(o,this.appContext.lang,1),this.appContext.flipper.isFlipped("enable-likes")&&(i=n.getValue("reactions"),t.likeCount=i&&i.like?i.like.count:0),this.setContainerWithTemplate("photo-list-photo-edit-interaction",t),this},activate:function(){var t=this,i=this.get("container"),n=i.one(".photo-list-photo-edit-interaction"),a=i.one(".tools"),o=i.one(".remove-own-photo"),r=i.one(".privacy-area");this.privacyMenuItems=[{text:this.intlMessage({intlName:"stats.PUBLIC"}),data:"public",privacyLevel:0,isSelected:function(){return"public"===t.privacyString}},{text:this.intlMessage({intlName:"stats.PRIVATE"}),data:"private",privacyLevel:3,isSelected:function(){return"private"===t.privacyString}},{text:this.intlMessage({intlName:"stats.FRIENDS"}),data:"friends",privacyLevel:2,isSelected:function(){return"friends"===t.privacyString}},{text:this.intlMessage({intlName:"stats.FAMILY"}),data:"family",privacyLevel:2,isSelected:function(){return"family"===t.privacyString}},{text:this.intlMessage({intlName:"stats.FF"}),data:"friendsandfamily",privacyLevel:1,isSelected:function(){return"friendsandfamily"===t.privacyString}}],e.on("phototitledesc:edit",(function(e){e.id===t.get("id")&&a.hide()})),e.on("phototitledesc:editdone",(function(e){if(e.id===t.get("id"))var i=setTimeout((function(){a.show(),clearTimeout(i)}),250)})),r.on("click",this.showPrivacyDroparound.bind(this)),e.Accessibility.makeDroparoundAnchorAccessible({view:this,getDroparound:this.getDroparound.bind(this),anchor:r,handler:this.showPrivacyDroparound.bind(this)}),this.appContext.getUA().isMobileOrTablet||(i.on(["mouseover","focus"],(function(e){o.removeClass("hidden"),n.addClass("has-focus")}),".overlay"),i.on(["mouseout","blur"],(function(e){o.addClass("hidden"),n.removeClass("has-focus")}),".overlay"))},getDroparound:function(){return this.dropdown},showPrivacyDroparound:function(t){var i=this;this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target,keyboardAnchorElement:t.target,closeOnScroll:!0,positionFixed:!0,preferBottom:!0,menuItems:this.privacyMenuItems}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",(function(e){e&&e.menuItem&&e.menuItem.data!==i.privacyString&&(i.changingToStricterPrivacy(e.menuItem)?i.showWarningModal(e.menuItem):i.changePrivacy(e.menuItem)),i.dropdown.close()})))},showWarningModal:function(t){var i=this;this.privacyChangeWarningModal=new e.Views.FluidModal({appContext:i.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!0,title:i.intlMessage({intlName:"photo-page-scrappy.STRICTER_PRIVACY_CHANGE_DIALOG_TITLE"}),actionButtonLabel:i.intlMessage({intlName:"common.OK"}),cancelButtonLabel:i.intlMessage({intlName:"common.CANCEL"}),message:i.intlMessage({intlName:"photo-page-scrappy.STRICTER_PRIVACY_CHANGE_DIALOG_MESSAGE"})}),this.privacyChangeWarningModal.on("actionClick",(function(e){i.changePrivacy(t)})),this.privacyChangeWarningModal.show()},changingToStricterPrivacy:function(t){var i=this;return e.Array.find(this.privacyMenuItems,(function(e){return e.data===i.privacyString})).privacyLevel<=t.privacyLevel},updateDisplayedInfo:function(e){var t=this;this.updatePrivacyIcon(e),this.updateEngagementInfoTimer=setTimeout((function(){t.updateEngagementInfo(),clearTimeout(t.updateEngagementInfoTimer)}),1e3)},updateEngagementInfo:function(){var t,i,n=this.get("container");return this.appContext.callAPI("flickr.photos.getInfo",{photo_id:this.get("id"),viewerNSID:this.nsid,extras:e.APIHelper.request.getRebootPhotoExtras(),timestamp:(new Date).getTime()}).then((function(a){t=parseInt(a.photo.count_faves,10),i=n.one(".fave-area .icon-count"),!Number.isNaN(t)&&t>0?(t=e.flutil.formatNumbers(t),i?i.set("text",t):(i=e.Node.create('<span class="icon-count">'+t+"</span>"),n.one(".fave-area").appendChild(i))):i&&i.remove()}))},updatePrivacyIcon:function(e){var t=this.get("container"),i=t.one(".privacy-icon");i.show(),i.replaceClass(this.privacyString,e.data),this.privacyString=e.data,t.one(".balls").remove()},changePrivacy:function(t){var i=this.get("privacy"),a=e.PrivacyHelper.mapPrivacy(t.data),o=this.get("container");o.one(".privacy-icon").hide(),o.one(".privacy-area").prepend(this.templates("flickr-balls")()),Object.keys(a).forEach((function(e){i.setValue(e,a[e])})),i.remoteUpdate().then(this.updateDisplayedInfo.bind(this,t)).catch((function(e){n.error({err:e})}))}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(e,t){return i.photoId(e)}},model:{writeOnce:"initOnly"},listModelParams:{writeOnce:"initOnly"},photoPageUrl:{writeOnce:"initOnly"},engagement:{value:null},engagementModelName:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}}}})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-photo-edit-interaction","hermes-template-flickr-balls","attribute-helpers","privacy-helper","sub-photo-title-desc-view","fluid-droparound-view","fluid-modal-view","intl-number"],optionalRequires:["hermes-core"],langBundles:["common","photo-page-scrappy","stats","likes"]});YUI.add("embed-size-helper",(function(h){h.EmbedSizeHelper={getSizes:function(h){var i={c:{width:800,height:600},h:{width:1600,height:1200},l:{width:1024,height:768},m:{width:500,height:375},n:{width:320,height:240},w:{width:400,height:300},z:{width:640,height:480},cp:{width:600,height:800},hp:{width:1200,height:1600},lp:{width:768,height:1024},mp:{width:375,height:500},np:{width:240,height:320},wp:{width:300,height:400},zp:{width:480,height:640}};return Object.keys(i).map((function(t){i[t].url=h.getSizeToFit({width:i[t].width,height:i[t].height}).url})),i}}}),"@VERSION@");YUI.add("fluid-share-gallery-view",(function(e,l){require("hermes-core/flog")(l);e.namespace("Views").FluidShareGalleryView=e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,subClassName:l,initializer:function(e){this.galleryId=e.galleryId},loadState:function(){return this.loadRequiredModels()},loadRequiredModels:function(){var l=this;return e.Promise.all([this.appContext.getModel("gallery-info-models",this.galleryId)]).then((function(e){if(l.galleryModel=e[0],l.set("photos",e[0].getValue("photoList").getList()),l.galleryModel.getValue("primaryPhotoId"))return this.appContext.getModel("photo-models",l.galleryModel.getValue("primaryPhotoId")).then((function(e){l.primaryPhotoModel=e}));l.isDisabled=!0}))},buildContainer:function(){return this.constructor.superclass.buildContainer.call(this,{sharingDisabled:this.isDisabled}),this},getTitleIntlKey:function(){return"SHARE_GALLERY_TO"},getGuestPassParams:function(){return{id:this.galleryModel.getValue("id"),contentMarkedPublic:!0,shareToAll:!0}},prepareFacebookShareParameters:function(){return{url:this.galleryModel.getValue("url")}},prepareTwitterShareParameters:function(){return{url:e.URLHelper.getShortGalleryURL(this.galleryId),title:this.galleryModel.getValue("title"),count:1}},prepareTumblrShareParameters:function(){return{title:this.galleryModel.getValue("title"),description:this.galleryModel.getValue("description"),displayPhotoURL:this.primaryPhotoModel.getValue("sizes").m.displayUrl,authorURL:this.galleryModel.getValue("owner").getValue("url"),ownerName:this.galleryModel.getValue("owner").getValue("displayname"),url:this.galleryModel.getValue("url"),count:1}},preparePinterestShareParameters:function(){return{title:this.galleryModel.getValue("title"),displayPhotoURL:this.primaryPhotoModel.getValue("sizes").m.displayUrl,shortURL:e.URLHelper.getShortGalleryURL(this.galleryId),url:this.galleryModel.getValue("url"),count:1}},prepareGooglePlusShareParameters:function(){return{url:this.galleryModel.getValue("url"),count:1}},prepareFlickrShareParameters:function(){return{modelName:"gallery",modelId:this.galleryId,modelOwnerId:this.galleryModel.getValue("owner").id,title:this.galleryModel.getValue("title"),url:this.galleryModel.getValue("url"),count:1}},prepareLinkShareParameters:function(){return{sizes:this.primaryPhotoModel?e.EmbedSizeHelper.getSizes(this.primaryPhotoModel):void 0,url:this.galleryModel.getValue("url"),title:this.galleryModel.getValue("title"),author:this.galleryModel.getValue("owner").getValue("displayname"),authorURL:this.galleryModel.getValue("owner").getValue("url"),shortURL:e.URLHelper.getShortGalleryURL(this.galleryId),supportsEmbedr:!0,privacyWarningString:"",generateLink:!1,count:1,galleryId:this.galleryId}}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper","embed-size-helper"],optionalRequires:["hermes-core"],langBundles:[]});YUI.add("hermes-template-gallery-edit-view",(function(e,t){var l=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,l,n,a){var i,s=null!=t?t:e.nullContext||{},o=e.hooks.helperMissing,c=e.escapeExpression,r="function",m=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="gallery-edit-container main">\n\t<header>\n\t\t<h1>'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"gallery.EDIT_GALLERY"},data:a,loc:{start:{line:3,column:6},end:{line:3,column:53}}}))+'</h1>\n\t\t<svg class="icon icon-close close-x-button"><use xlink:href="#icon-close"></use></svg>\n\t</header>\n\t<div class="gallery-edit-item gallery-edit-title-item">\n\t\t<label for="gallery-title-input">'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"common.TITLE"},data:a,loc:{start:{line:7,column:35},end:{line:7,column:74}}}))+'</label>\n\t\t<input type="text" id="gallery-title-input" class="input-field gallery-title-input" placeholder="'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"gallery.ADD_A_TITLE"},data:a,loc:{start:{line:8,column:99},end:{line:8,column:145}}}))+'" value="'+c(typeof(i=null!=(i=m(l,"title")||(null!=t?m(t,"title"):t))?i:o)===r?i.call(s,{name:"title",hash:{},data:a,loc:{start:{line:8,column:154},end:{line:8,column:163}}}):i)+'"/>\n\t</div>\n\t<div class="gallery-edit-item gallery-edit-description-item">\n\t\t<label for="gallery-description-input">'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"common.DESCRIPTION"},data:a,loc:{start:{line:11,column:41},end:{line:11,column:86}}}))+'</label>\n\t\t<textarea id="gallery-description-input" class="input-field gallery-description-input" placeholder="'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"gallery.ADD_A_DESCRIPTION"},data:a,loc:{start:{line:12,column:102},end:{line:12,column:154}}}))+'" >'+c(typeof(i=null!=(i=m(l,"description")||(null!=t?m(t,"description"):t))?i:o)===r?i.call(s,{name:"description",hash:{},data:a,loc:{start:{line:12,column:157},end:{line:12,column:172}}}):i)+'</textarea>\n\t</div>\n\t<div class="gallery-edit-item gallery-edit-coverphoto-item">\n\t\t<label>'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"gallery.COVER_PHOTO"},data:a,loc:{start:{line:15,column:9},end:{line:15,column:55}}}))+'</label>\n\t\t<div class="icon">\n\t\t\t<div class="photo"></div>\n\t\t\t<div></div>\n\t\t\t<div></div>\n\t\t</div>\n\t\t<a role="button" class="cover-photo-button" tabindex="0">'+c(typeof(i=null!=(i=m(l,"coverPhotoText")||(null!=t?m(t,"coverPhotoText"):t))?i:o)===r?i.call(s,{name:"coverPhotoText",hash:{},data:a,loc:{start:{line:21,column:59},end:{line:21,column:77}}}):i)+'</a>\n\t</div>\n\t<div class="action-container">\n\t\t<a role="button" class="delete-button" tabindex="0">'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"gallery.DELETE_GALLERY"},data:a,loc:{start:{line:24,column:54},end:{line:24,column:103}}}))+'</a>\n\t\t<div class="buttons">\n\t\t\t<button class="mini alt cancel-button">'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:a,loc:{start:{line:26,column:42},end:{line:26,column:82}}}))+'</button>\n\t\t\t<button class="mini save-button">'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"common.SAVE"},data:a,loc:{start:{line:27,column:36},end:{line:27,column:74}}}))+'</button>\n\t\t</div>\n\t</div>\n</div>\n<div class="gallery-edit-container confirm-delete hidden">\n\t<header>\n\t\t<h1>'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"common.CONFIRMATION"},data:a,loc:{start:{line:33,column:6},end:{line:33,column:52}}}))+'</h1>\n\t\t<svg class="icon icon-close close-x-button"><use xlink:href="#icon-close"></use></svg>\n\t</header>\n\t<p>'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"gallery.GALLERY_CONFIRM_DELETE_MESSAGE"},data:a,loc:{start:{line:36,column:4},end:{line:36,column:69}}}))+'</p>\n\t<div class="buttons">\n\t\t<button class="mini alt cancel-button">'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:a,loc:{start:{line:38,column:41},end:{line:38,column:81}}}))+'</button>\n\t\t<button class="mini confirm-button">'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"common.OK"},data:a,loc:{start:{line:39,column:38},end:{line:39,column:74}}}))+"</button>\n\t</div>\n</div>\n"},useData:!0}),n={};e.Array.each([],(function(t){var l=e.Template.get("hermes/"+t);l&&(n[t]=l)})),e.Template.register("hermes/gallery-edit-view",(function(t,a){return(a=a||{}).partials=a.partials?e.merge(n,a.partials):n,l(t,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("gallery-edit-view",(function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.isSaving=!1,this.isDeleting=!1,this.coverPhotoUrl="",this.coverPhotoText=""},loadState:function(){var e=this;return this.appContext.getModel("gallery-info-models",this.params.galleryId).then((function(t){if(e.galleryInfoModel=t,e.initialPrimaryPhotoId=e.galleryInfoModel.getValue("primaryPhotoId"),e.params.coverPhotoId||e.initialPrimaryPhotoId)return this.appContext.getModel("photo-models",e.params.coverPhotoId||e.initialPrimaryPhotoId).then((function(t){e.primaryPhotoModel=t}))}))},buildContainer:function(){var e=this.galleryInfoModel.toJSON();this.primaryPhotoModel&&this.primaryPhotoModel.getValue("sizes").sq?(this.coverPhotoUrl=this.primaryPhotoModel.getValue("sizes").sq.displayUrl,this.coverPhotoText=this.intlMessage({intlName:"gallery.CHANGE_COVER_PHOTO"})):this.coverPhotoText=this.intlMessage({intlName:"gallery.CHOOSE_A_COVER_PHOTO"}),e.coverPhotoText=this.coverPhotoText,e.title=this.params.title||e.title,e.description=this.params.description||e.description,this.setContainerWithTemplate("gallery-edit-view",e)},activate:function(){var e=this.get("container");this.containerNodes={main:e.one(".gallery-edit-container.main"),confirmDelete:e.one(".gallery-edit-container.confirm-delete")},this.closeX=this.containerNodes.main.one(".close-x-button"),this.saveButton=this.containerNodes.main.one(".save-button"),this.cancelButton=this.containerNodes.main.one(".cancel-button"),this.deleteButton=this.containerNodes.main.one(".delete-button"),this.titleField=this.containerNodes.main.one(".gallery-title-input"),this.descriptionField=this.containerNodes.main.one(".gallery-description-input"),this.coverPhotoItem=this.containerNodes.main.one(".gallery-edit-coverphoto-item"),this.coverPhotoNode=this.coverPhotoItem.one(".photo"),this.coverPhotoButton=this.containerNodes.main.one(".cover-photo-button"),this.deleteConfirmButton=this.containerNodes.confirmDelete.one(".confirm-button"),this.deleteCancelButton=this.containerNodes.confirmDelete.one(".cancel-button"),this.deleteCloseX=this.containerNodes.confirmDelete.one(".close-x-button"),this.registerEventHandler(this.closeX.on("click",this.closeModal.bind(this))),this.registerEventHandler(this.cancelButton.on("click",this.closeModal.bind(this))),this.registerEventHandler(this.saveButton.on("click",this.handleSaveClick.bind(this))),this.registerEventHandler(this.coverPhotoButton.on(["click","key"],this.handleCoverPhotoClick.bind(this),"down:13")),this.registerEventHandler(this.deleteButton.on(["click","key"],this.handleDeleteClick.bind(this),"down:13")),this.registerEventHandler(this.deleteCloseX.on("click",this.closeModal.bind(this))),this.registerEventHandler(this.deleteCancelButton.on("click",this.showContainerNode.bind(this,"main"))),this.registerEventHandler(this.deleteConfirmButton.on("click",this.handleDeleteConfirmClick.bind(this))),this.titleField.focus(),this.showCoverPhoto(this.coverPhotoUrl)},closeModal:function(){e.fire("galleryEdit:close")},handleSaveClick:function(t){var o=this,n=(this.galleryInfoModel.getValue("title"),this.galleryInfoModel.getValue("description"),{title:this.titleField.get("value"),description:this.descriptionField.get("value")}),r=[];if(!this.isSaving)return this.isSaving=!0,this.saveButton.setAttribute("disabled"),e.rapidTracker.beacon(this.name,"galleryEditSaveClick"),r.push(this.galleryInfoModel.updateMetaRemote(n)),this.primaryPhotoModel&&this.primaryPhotoModel.id!==o.initialPrimaryPhotoId&&(e.rapidTracker.beacon(this.name,"galleryEditPrimaryPhotoChange"),r.push(this.galleryInfoModel.updatePrimaryPhotoRemote(this.primaryPhotoModel.id).then((function(){o.galleryInfoModel.setValue("primaryPhotoId",o.primaryPhotoModel.id)})).catch((function(e){throw i.error("Error updating gallery primary photo",{err:e}),e})))),e.Promise.all(r).then((function(t){o.isSaving=!1,o.saveButton.removeAttribute("disabled"),e.fire("galleryEdit:close")})).catch((function(e){throw i.error("Error updating gallery info",{err:e}),o.isSaving=!1,o.saveButton.removeAttribute("disabled"),e}))},handleDeleteClick:function(){e.rapidTracker.beacon(this.name,"galleryEditDeleteClick"),this.showContainerNode("confirmDelete")},showContainerNode:function(t){for(var i in this.containerNodes)this.containerNodes.hasOwnProperty(i)&&this.containerNodes[i].addClass("hidden");this.containerNodes[t].removeClass("hidden"),"main"===t&&this.titleField.focus(),e.fire("galleryEdit:reposition")},handleDeleteConfirmClick:function(){var t=this;return t.isDeleting=!0,t.deleteConfirmButton.setAttribute("disabled"),this.galleryInfoModel.deleteRemote().then((function(i){t.isDeleting=!1,t.deleteConfirmButton.removeAttribute("disabled"),e.fire("galleryEdit:deleted")})).catch((function(e){throw i.error("Error deleting gallery",{err:e}),t.isDeleting=!1,t.deleteConfirmButton.removeAttribute("disabled"),e}))},handleCoverPhotoClick:function(){e.fire("galleryEdit:coverPhotoClicked",{storedEditMeta:{title:this.titleField.get("value"),description:this.descriptionField.get("value")}})},showCoverPhoto:function(e){this.coverPhotoNode.setStyle("backgroundImage","url("+e+")")}})}),"@VERSION@",{requires:["flickr-view","fluid-modal-nav-bar-view","hermes-template-gallery-edit-view"],optionalRequires:["hermes-core"],langBundles:["common","gallery"]});YUI.add("hermes-template-reorder-grid-modal-view",(function(e,n){var t=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,n,t,a,r){var l,i=null!=n?n:e.nullContext||{},o=e.hooks.helperMissing,s=e.escapeExpression,c="function",d=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"<header>\n\t<h1>"+s((d(t,"intlMessage")||n&&d(n,"intlMessage")||o).call(i,{name:"intlMessage",hash:{intlName:"reorder.REORDER_ITEMS"},data:r,loc:{start:{line:2,column:5},end:{line:2,column:53}}}))+'</h1>\n</header>\n<div class="reorder-grid-container">\n\t'+s((d(t,"outlet")||n&&d(n,"outlet")||o).call(i,null!=n?d(n,"reorder-grid-view"):n,{name:"outlet",hash:{},data:r,loc:{start:{line:5,column:1},end:{line:5,column:29}}}))+'\n</div>\n<div class="drag-interaction-container">\n\t<div class="text-container">\n\t\t<span class="drag-tip">'+s((d(t,"renderTrustedMarkup")||n&&d(n,"renderTrustedMarkup")||o).call(i,null!=n?d(n,"dragTipHtml"):n,{name:"renderTrustedMarkup",hash:{},data:r,loc:{start:{line:9,column:25},end:{line:9,column:60}}}))+'</span>\n\t\t<span class="drag-error hidden">'+s((d(t,"renderTrustedMarkup")||n&&d(n,"renderTrustedMarkup")||o).call(i,null!=n?d(n,"dragErrorHtml"):n,{name:"renderTrustedMarkup",hash:{},data:r,loc:{start:{line:10,column:34},end:{line:10,column:71}}}))+'</span>\n\t</div>\n\t<div class="button-container">\n\t\t<button class="mini alt cancel-button">'+s(typeof(l=null!=(l=d(t,"cancelText")||(null!=n?d(n,"cancelText"):n))?l:o)===c?l.call(i,{name:"cancelText",hash:{},data:r,loc:{start:{line:13,column:41},end:{line:13,column:55}}}):l)+'</button>\n\t\t<button class="mini confirm-button" disabled>'+s(typeof(l=null!=(l=d(t,"confirmText")||(null!=n?d(n,"confirmText"):n))?l:o)===c?l.call(i,{name:"confirmText",hash:{},data:r,loc:{start:{line:14,column:47},end:{line:14,column:62}}}):l)+"</button>\n\t</div>\n</div>\n"},useData:!0}),a={};e.Array.each([],(function(n){var t=e.Template.get("hermes/"+n);t&&(a[n]=t)})),e.Template.register("hermes/reorder-grid-modal-view",(function(n,r){return(r=r||{}).partials=r.partials?e.merge(a,r.partials):a,t(n,r)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});