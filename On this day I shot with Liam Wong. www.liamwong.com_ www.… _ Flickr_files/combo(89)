YUI.add("hermes-template-sub-photo-tags-tag-section",(function(n,t){var l=n.Template.Handlebars.revive({1:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"isResponsiveMobilePhotoPage"):t,{name:"if",hash:{},fn:n.program(2,e,0),inverse:n.program(7,e,0),data:e,loc:{start:{line:2,column:1},end:{line:10,column:8}}}))?o:""},2:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"tagsContainerIsEmpty"):t,{name:"if",hash:{},fn:n.program(3,e,0),inverse:n.program(5,e,0),data:e,loc:{start:{line:3,column:2},end:{line:7,column:9}}}))?o:""},3:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<a href="#" class="show-add-tags">'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TAGS"},data:e,loc:{start:{line:4,column:38},end:{line:4,column:92}}}))+"</a>\n"},5:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<a href="#" class="show-add-tags">'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.EDIT_TAGS"},data:e,loc:{start:{line:6,column:38},end:{line:6,column:93}}}))+"</a>\n"},7:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t<a href="#" class="show-add-tags">'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TAGS"},data:e,loc:{start:{line:9,column:36},end:{line:9,column:90}}}))+"</a>\n"},9:function(n,t,l,a,e){var o,r=null!=t?t:n.nullContext||{},u=n.hooks.helperMissing,i=n.escapeExpression,s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t<a class="tag-section-header" href="'+i("function"==typeof(o=null!=(o=s(l,"tagPageURL")||(null!=t?s(t,"tagPageURL"):t))?o:u)?o.call(r,{name:"tagPageURL",hash:{},data:e,loc:{start:{line:14,column:37},end:{line:14,column:51}}}):o)+'">'+i((s(l,"intlMessage")||t&&s(t,"intlMessage")||u).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAGS"},data:e,loc:{start:{line:14,column:53},end:{line:14,column:103}}}))+"</a>\n"},11:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t<h3 class="tag-section-header">'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAGS"},data:e,loc:{start:{line:16,column:32},end:{line:16,column:82}}}))+"</h3>\n"},13:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"unless").call(null!=t?t:n.nullContext||{},null!=t?r(t,"isMobile"):t,{name:"unless",hash:{},fn:n.program(14,e,0),inverse:n.noop,data:e,loc:{start:{line:20,column:1},end:{line:24,column:12}}}))?o:""},14:function(n,t,l,a,e){return'\t\t<span class="autotags-helper">\n\t\t\t<i class="autotags-helper-icon"></i>\n\t\t</span>\n'},16:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<input type="text" class= "add-tag" placeholder="'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_A_TAG"},data:e,loc:{start:{line:30,column:52},end:{line:30,column:107}}}))+'">\n'},18:function(n,t,l,a,e){var o,r,u=null!=t?t:n.nullContext||{},i=n.hooks.helperMissing,s="function",c=n.escapeExpression,p=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<li data-author="'+c(typeof(r=null!=(r=p(l,"tagAuthorNSID")||(null!=t?p(t,"tagAuthorNSID"):t))?r:i)===s?r.call(u,{name:"tagAuthorNSID",hash:{},data:e,loc:{start:{line:33,column:20},end:{line:33,column:37}}}):r)+'" data-tag-id="'+c(typeof(r=null!=(r=p(l,"id")||(null!=t?p(t,"id"):t))?r:i)===s?r.call(u,{name:"id",hash:{},data:e,loc:{start:{line:33,column:52},end:{line:33,column:58}}}):r)+'" class="tag '+(null!=(o=p(l,"if").call(u,(o=e&&p(e,"root"))&&p(o,"isResponsiveMobilePhotoPage"),{name:"if",hash:{},fn:n.noop,inverse:n.program(19,e,0),data:e,loc:{start:{line:33,column:71},end:{line:33,column:212}}}))?o:"")+'" '+(null!=(o=p(l,"if").call(u,(o=e&&p(e,"root"))&&p(o,"autotagsEnabled"),{name:"if",hash:{},fn:n.program(22,e,0),inverse:n.noop,data:e,loc:{start:{line:33,column:214},end:{line:33,column:323}}}))?o:"")+' data-track="tagClick">\n\t\t\t\t<a class="'+(null!=(o=p(l,"if").call(u,(o=e&&p(e,"root"))&&p(o,"autotagsEnabled"),{name:"if",hash:{},fn:n.program(25,e,0),inverse:n.program(28,e,0),data:e,loc:{start:{line:34,column:14},end:{line:34,column:134}}}))?o:"")+'" href="#">\n\t\t\t\t\t<i class="'+(null!=(o=p(l,"if").call(u,(o=e&&p(e,"root"))&&p(o,"autotagsEnabled"),{name:"if",hash:{},fn:n.program(30,e,0),inverse:n.program(33,e,0),data:e,loc:{start:{line:35,column:15},end:{line:35,column:135}}}))?o:"")+'" title="'+c((p(l,"intlMessage")||t&&p(t,"intlMessage")||i).call(u,{name:"intlMessage",hash:{intlName:"common.DELETE"},data:e,loc:{start:{line:35,column:144},end:{line:35,column:184}}}))+'"></i>\n\t\t\t\t</a>\n\t\t\t\t<a href="'+(null!=(o=p(l,"if").call(u,(o=e&&p(e,"root"))&&p(o,"linkTagToTagsPage"),{name:"if",hash:{},fn:n.program(35,e,0),inverse:n.program(37,e,0),data:e,loc:{start:{line:37,column:13},end:{line:37,column:79}}}))?o:"")+'" title="'+c(typeof(r=null!=(r=p(l,"tagRaw")||(null!=t?p(t,"tagRaw"):t))?r:i)===s?r.call(u,{name:"tagRaw",hash:{},data:e,loc:{start:{line:37,column:88},end:{line:37,column:98}}}):r)+'">'+c(typeof(r=null!=(r=p(l,"tagRaw")||(null!=t?p(t,"tagRaw"):t))?r:i)===s?r.call(u,{name:"tagRaw",hash:{},data:e,loc:{start:{line:37,column:100},end:{line:37,column:110}}}):r)+"</a>\n\t\t\t</li>\n"},19:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=(r(l,"canRemoveTag")||t&&r(t,"canRemoveTag")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},null!=t?r(t,"tagAuthorNSID"):t,(o=e&&r(e,"root"))&&r(o,"viewerNSID"),(o=e&&r(e,"root"))&&r(o,"isOwner"),{name:"canRemoveTag",hash:{},fn:n.program(20,e,0),inverse:n.noop,data:e,loc:{start:{line:33,column:112},end:{line:33,column:205}}}))?o:""},20:function(n,t,l,a,e){return"can-remove-tag"},22:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"duplicateAutotagId"):t,{name:"if",hash:{},fn:n.program(23,e,0),inverse:n.noop,data:e,loc:{start:{line:33,column:243},end:{line:33,column:316}}}))?o:""},23:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'data-autotag-id="'+n.escapeExpression("function"==typeof(o=null!=(o=r(l,"duplicateAutotagId")||(null!=t?r(t,"duplicateAutotagId"):t))?o:n.hooks.helperMissing)?o.call(null!=t?t:n.nullContext||{},{name:"duplicateAutotagId",hash:{},data:e,loc:{start:{line:33,column:286},end:{line:33,column:308}}}):o)+'"'},25:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"duplicateAutotagId"):t,{name:"if",hash:{},fn:n.program(26,e,0),inverse:n.program(28,e,0),data:e,loc:{start:{line:34,column:43},end:{line:34,column:109}}}))?o:""},26:function(n,t,l,a,e){return"remove-dual-tag"},28:function(n,t,l,a,e){return"remove-tag"},30:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"duplicateAutotagId"):t,{name:"if",hash:{},fn:n.program(31,e,0),inverse:n.program(33,e,0),data:e,loc:{start:{line:35,column:44},end:{line:35,column:110}}}))?o:""},31:function(n,t,l,a,e){return"delete-dual-tag"},33:function(n,t,l,a,e){return"delete-tag"},35:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression("function"==typeof(o=null!=(o=r(l,"url")||(null!=t?r(t,"url"):t))?o:n.hooks.helperMissing)?o.call(null!=t?t:n.nullContext||{},{name:"url",hash:{},data:e,loc:{start:{line:37,column:44},end:{line:37,column:51}}}):o)},37:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression("function"==typeof(o=null!=(o=r(l,"searchUrl")||(null!=t?r(t,"searchUrl"):t))?o:n.hooks.helperMissing)?o.call(null!=t?t:n.nullContext||{},{name:"searchUrl",hash:{},data:e,loc:{start:{line:37,column:59},end:{line:37,column:72}}}):o)},39:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"each").call(null!=t?t:n.nullContext||{},null!=t?r(t,"autotags"):t,{name:"each",hash:{},fn:n.program(40,e,0),inverse:n.noop,data:e,loc:{start:{line:41,column:3},end:{line:55,column:12}}}))?o:""},40:function(n,t,l,a,e){var o,r,u=null!=t?t:n.nullContext||{},i=n.hooks.helperMissing,s="function",c=n.escapeExpression,p=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<li class="autotag '+(null!=(o=p(l,"if").call(u,null!=t?p(t,"isPrivate"):t,{name:"if",hash:{},fn:n.program(41,e,0),inverse:n.noop,data:e,loc:{start:{line:42,column:23},end:{line:42,column:54}}}))?o:"")+" "+(null!=(o=p(l,"if").call(u,(o=e&&p(e,"root"))&&p(o,"viewerIsOwner"),{name:"if",hash:{},fn:n.program(20,e,0),inverse:n.noop,data:e,loc:{start:{line:42,column:55},end:{line:42,column:103}}}))?o:"")+'" data-autotag-content="'+c(typeof(r=null!=(r=p(l,"autotagValue")||(null!=t?p(t,"autotagValue"):t))?r:i)===s?r.call(u,{name:"autotagValue",hash:{},data:e,loc:{start:{line:42,column:127},end:{line:42,column:143}}}):r)+'" data-autotag-id="'+c(typeof(r=null!=(r=p(l,"id")||(null!=t?p(t,"id"):t))?r:i)===s?r.call(u,{name:"id",hash:{},data:e,loc:{start:{line:42,column:162},end:{line:42,column:168}}}):r)+'" data-track="autotagClick">\n'+(null!=(o=p(l,"if").call(u,(o=e&&p(e,"root"))&&p(o,"viewerIsOwner"),{name:"if",hash:{},fn:n.program(43,e,0),inverse:n.noop,data:e,loc:{start:{line:43,column:5},end:{line:47,column:12}}}))?o:"")+(null!=(o=p(l,"if").call(u,null!=t?p(t,"isPrivate"):t,{name:"if",hash:{},fn:n.program(45,e,0),inverse:n.noop,data:e,loc:{start:{line:48,column:5},end:{line:52,column:12}}}))?o:"")+'\t\t\t\t\t<a href="'+(null!=(o=p(l,"if").call(u,(o=e&&p(e,"root"))&&p(o,"linkTagToTagsPage"),{name:"if",hash:{},fn:n.program(47,e,0),inverse:n.program(37,e,0),data:e,loc:{start:{line:53,column:14},end:{line:53,column:109}}}))?o:"")+'" title="'+c(typeof(r=null!=(r=p(l,"autotagValue")||(null!=t?p(t,"autotagValue"):t))?r:i)===s?r.call(u,{name:"autotagValue",hash:{},data:e,loc:{start:{line:53,column:118},end:{line:53,column:134}}}):r)+'">'+c(typeof(r=null!=(r=p(l,"autotagValue")||(null!=t?p(t,"autotagValue"):t))?r:i)===s?r.call(u,{name:"autotagValue",hash:{},data:e,loc:{start:{line:53,column:136},end:{line:53,column:152}}}):r)+"</a>\n\t\t\t\t</li>\n"},41:function(n,t,l,a,e){return"private"},43:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t\t<span class="remove-autotag">\n\t\t\t\t\t\t\t<i class="delete-autotag" title="'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.DELETE"},data:e,loc:{start:{line:45,column:40},end:{line:45,column:80}}}))+'"></i>\n\t\t\t\t\t\t</span>\n'},45:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t\t<span class="private-autotag">\n\t\t\t\t\t\t\t<i class="private-autotag-icon" title="'+n.escapeExpression(n.lambda((o=e&&r(e,"root"))&&r(o,"privateAutotagHelperText"),t))+'"></i>\n\t\t\t\t\t\t</span>\n'},47:function(n,t,l,a,e){var o,r,u=n.escapeExpression,i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return u(n.lambda((o=e&&i(e,"root"))&&i(o,"tagPageURL"),t))+u("function"==typeof(r=null!=(r=i(l,"autotagValue")||(null!=t?i(t,"autotagValue"):t))?r:n.hooks.helperMissing)?r.call(null!=t?t:n.nullContext||{},{name:"autotagValue",hash:{},data:e,loc:{start:{line:53,column:65},end:{line:53,column:81}}}):r)},49:function(n,t,l,a,e){var o,r,u=null!=t?t:n.nullContext||{},i=n.hooks.helperMissing,s="function",c=n.escapeExpression,p=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<li data-author="'+c(typeof(r=null!=(r=p(l,"tagAuthorNSID")||(null!=t?p(t,"tagAuthorNSID"):t))?r:i)===s?r.call(u,{name:"tagAuthorNSID",hash:{},data:e,loc:{start:{line:62,column:21},end:{line:62,column:38}}}):r)+'" data-tag-id="'+c(typeof(r=null!=(r=p(l,"id")||(null!=t?p(t,"id"):t))?r:i)===s?r.call(u,{name:"id",hash:{},data:e,loc:{start:{line:62,column:53},end:{line:62,column:59}}}):r)+'" class="tag '+(null!=(o=p(l,"if").call(u,(o=e&&p(e,"root"))&&p(o,"isResponsiveMobilePhotoPage"),{name:"if",hash:{},fn:n.noop,inverse:n.program(19,e,0),data:e,loc:{start:{line:62,column:72},end:{line:62,column:213}}}))?o:"")+'" data-track="tagClick">\n\t\t\t\t\t<a class="remove-tag" href="#">\n\t\t\t\t\t\t<i class="delete-tag" title="'+c((p(l,"intlMessage")||t&&p(t,"intlMessage")||i).call(u,{name:"intlMessage",hash:{intlName:"common.DELETE"},data:e,loc:{start:{line:64,column:35},end:{line:64,column:75}}}))+'"></i>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a href="'+(null!=(o=p(l,"if").call(u,(o=e&&p(e,"root"))&&p(o,"linkTagToTagsPage"),{name:"if",hash:{},fn:n.program(35,e,0),inverse:n.program(37,e,0),data:e,loc:{start:{line:66,column:14},end:{line:66,column:80}}}))?o:"")+'" title="'+c(typeof(r=null!=(r=p(l,"tagRaw")||(null!=t?p(t,"tagRaw"):t))?r:i)===s?r.call(u,{name:"tagRaw",hash:{},data:e,loc:{start:{line:66,column:89},end:{line:66,column:99}}}):r)+'">'+c(typeof(r=null!=(r=p(l,"tagRaw")||(null!=t?p(t,"tagRaw"):t))?r:i)===s?r.call(u,{name:"tagRaw",hash:{},data:e,loc:{start:{line:66,column:101},end:{line:66,column:111}}}):r)+"</a>\n\t\t\t\t</li>\n"},compiler:[8,">= 4.3.0"],main:function(n,t,l,a,e){var o,r=null!=t?t:n.nullContext||{},u=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(o=u(l,"if").call(r,null!=t?u(t,"canAddMeta"):t,{name:"if",hash:{},fn:n.program(1,e,0),inverse:n.noop,data:e,loc:{start:{line:1,column:0},end:{line:11,column:7}}}))?o:"")+"\n"+(null!=(o=u(l,"if").call(r,null!=t?u(t,"linkTagToTagsPage"):t,{name:"if",hash:{},fn:n.program(9,e,0),inverse:n.program(11,e,0),data:e,loc:{start:{line:13,column:0},end:{line:17,column:7}}}))?o:"")+"\n"+(null!=(o=u(l,"if").call(r,null!=t?u(t,"showTagInfoBlock"):t,{name:"if",hash:{},fn:n.program(13,e,0),inverse:n.noop,data:e,loc:{start:{line:19,column:0},end:{line:25,column:7}}}))?o:"")+'\n<div class="tags-list-container">\n\t<ul class="tags-list">\n'+(null!=(o=u(l,"if").call(r,null!=t?u(t,"canAddMeta"):t,{name:"if",hash:{},fn:n.program(16,e,0),inverse:n.noop,data:e,loc:{start:{line:29,column:2},end:{line:31,column:9}}}))?o:"")+(null!=(o=u(l,"each").call(r,null!=t?u(t,"tags"):t,{name:"each",hash:{},fn:n.program(18,e,0),inverse:n.noop,data:e,loc:{start:{line:32,column:2},end:{line:39,column:11}}}))?o:"")+(null!=(o=u(l,"if").call(r,null!=t?u(t,"autotagsEnabled"):t,{name:"if",hash:{},fn:n.program(39,e,0),inverse:n.noop,data:e,loc:{start:{line:40,column:2},end:{line:56,column:9}}}))?o:"")+'\t</ul>\n\n\t<div class="machine-tags-section">\n\t\t<ul class="machine-tags-list">\n'+(null!=(o=u(l,"each").call(r,null!=t?u(t,"machineTags"):t,{name:"each",hash:{},fn:n.program(49,e,0),inverse:n.noop,data:e,loc:{start:{line:61,column:3},end:{line:68,column:12}}}))?o:"")+"\t\t</ul>\n\t</div>\n</div>\n"},useData:!0}),a={};n.Array.each([],(function(t){var l=n.Template.get("hermes/"+t);l&&(a[t]=l)})),n.Template.register("hermes/sub-photo-tags-tag-section",(function(t,e){return(e=e||{}).partials=e.partials?n.merge(a,e.partials):a,l(t,e)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-tags-tag",(function(n,a){var l=n.Template.Handlebars.revive({1:function(n,a,l,e,t){var o,r,c=null!=a?a:n.nullContext||{},i=n.lookupProperty||function(n,a){if(Object.prototype.hasOwnProperty.call(n,a))return n[a]};return(null!=(o=i(l,"if").call(c,null!=a?i(a,"isNewTag"):a,{name:"if",hash:{},fn:n.program(2,t,0),inverse:n.noop,data:t,loc:{start:{line:2,column:1},end:{line:4,column:8}}}))?o:"")+(null!=(o=i(l,"if").call(c,null!=a?i(a,"isNormalTag"):a,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t,loc:{start:{line:5,column:1},end:{line:7,column:8}}}))?o:"")+(null!=(o=i(l,"if").call(c,null!=a?i(a,"isMachineTag"):a,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t,loc:{start:{line:8,column:1},end:{line:10,column:8}}}))?o:"")+'\t\t\t<div class="tag-content">\n\t\t\t\t<svg class="icon-tag"><use xlink:href="#icon-tag"></use></svg>\n\t\t\t\t<p>'+n.escapeExpression("function"==typeof(r=null!=(r=i(l,"tagRaw")||(null!=a?i(a,"tagRaw"):a))?r:n.hooks.helperMissing)?r.call(c,{name:"tagRaw",hash:{},data:t,loc:{start:{line:13,column:7},end:{line:13,column:17}}}):r)+"</p>\n\t\t\t</div>\n"+(null!=(o=i(l,"if").call(c,null!=a?i(a,"isNewTag"):a,{name:"if",hash:{},fn:n.program(8,t,0),inverse:n.program(10,t,0),data:t,loc:{start:{line:15,column:3},end:{line:19,column:10}}}))?o:"")+"\t\t</li>\n"},2:function(n,a,l,e,t){var o,r,c=null!=a?a:n.nullContext||{},i=n.hooks.helperMissing,u="function",s=n.escapeExpression,g=n.lookupProperty||function(n,a){if(Object.prototype.hasOwnProperty.call(n,a))return n[a]};return'\t\t<li data-value="'+s(typeof(r=null!=(r=g(l,"tagRaw")||(null!=a?g(a,"tagRaw"):a))?r:i)===u?r.call(c,{name:"tagRaw",hash:{},data:t,loc:{start:{line:3,column:18},end:{line:3,column:28}}}):r)+'" data-tag-id="'+s(typeof(r=null!=(r=g(l,"escapedTagRaw")||(null!=a?g(a,"escapedTagRaw"):a))?r:i)===u?r.call(c,{name:"escapedTagRaw",hash:{},data:t,loc:{start:{line:3,column:43},end:{line:3,column:60}}}):r)+'" '+(null!=(o=g(l,"if").call(c,null!=a?g(a,"mightExist"):a,{name:"if",hash:{},fn:n.program(3,t,0),inverse:n.noop,data:t,loc:{start:{line:3,column:62},end:{line:3,column:114}}}))?o:"")+' class="tag remove-tag can-remove-tag" data-validated="false" data-track="tagClick">\n'},3:function(n,a,l,e,t){return'data-tag-might-exist="true"'},5:function(n,a,l,e,t){var o,r,c=null!=a?a:n.nullContext||{},i=n.hooks.helperMissing,u="function",s=n.escapeExpression,g=n.lookupProperty||function(n,a){if(Object.prototype.hasOwnProperty.call(n,a))return n[a]};return'\t\t<li data-value="'+s(typeof(r=null!=(r=g(l,"tagRaw")||(null!=a?g(a,"tagRaw"):a))?r:i)===u?r.call(c,{name:"tagRaw",hash:{},data:t,loc:{start:{line:6,column:18},end:{line:6,column:28}}}):r)+'" data-author="'+s(typeof(r=null!=(r=g(l,"tagAuthorNSID")||(null!=a?g(a,"tagAuthorNSID"):a))?r:i)===u?r.call(c,{name:"tagAuthorNSID",hash:{},data:t,loc:{start:{line:6,column:43},end:{line:6,column:60}}}):r)+'" data-tag-id="'+s(typeof(r=null!=(r=g(l,"id")||(null!=a?g(a,"id"):a))?r:i)===u?r.call(c,{name:"id",hash:{},data:t,loc:{start:{line:6,column:75},end:{line:6,column:81}}}):r)+'" class="tag remove-tag '+(null!=(o=(g(l,"canRemoveTag")||a&&g(a,"canRemoveTag")||i).call(c,null!=a?g(a,"tagAuthorNSID"):a,(o=t&&g(t,"root"))&&g(o,"viewerNSID"),(o=t&&g(t,"root"))&&g(o,"isOwner"),{name:"canRemoveTag",hash:{},fn:n.program(6,t,0),inverse:n.noop,data:t,loc:{start:{line:6,column:105},end:{line:6,column:198}}}))?o:"")+'" data-track="tagClick">\n'},6:function(n,a,l,e,t){return"can-remove-tag"},8:function(n,a,l,e,t){return'\t\t\t\t<svg class="icon icon-check_circle can-remove-tag"><use xlink:href="#icon-check_circle"></use></svg>\n'},10:function(n,a,l,e,t){var o,r=n.lookupProperty||function(n,a){if(Object.prototype.hasOwnProperty.call(n,a))return n[a]};return'\t\t\t\t<svg class="icon icon-check_circle '+(null!=(o=(r(l,"canRemoveTag")||a&&r(a,"canRemoveTag")||n.hooks.helperMissing).call(null!=a?a:n.nullContext||{},null!=a?r(a,"tagAuthorNSID"):a,(o=t&&r(t,"root"))&&r(o,"viewerNSID"),(o=t&&r(t,"root"))&&r(o,"isOwner"),{name:"canRemoveTag",hash:{},fn:n.program(6,t,0),inverse:n.noop,data:t,loc:{start:{line:18,column:39},end:{line:18,column:132}}}))?o:"")+'"><use xlink:href="#icon-check_circle"></use></svg>\n'},12:function(n,a,l,e,t){var o,r,c=null!=a?a:n.nullContext||{},i=n.hooks.helperMissing,u="function",s=n.escapeExpression,g=n.lookupProperty||function(n,a){if(Object.prototype.hasOwnProperty.call(n,a))return n[a]};return'\t<li data-tag-id="'+s(typeof(r=null!=(r=g(l,"escapedTagRaw")||(null!=a?g(a,"escapedTagRaw"):a))?r:i)===u?r.call(c,{name:"escapedTagRaw",hash:{},data:t,loc:{start:{line:22,column:18},end:{line:22,column:35}}}):r)+'" '+(null!=(o=g(l,"if").call(c,null!=a?g(a,"mightExist"):a,{name:"if",hash:{},fn:n.program(3,t,0),inverse:n.noop,data:t,loc:{start:{line:22,column:37},end:{line:22,column:89}}}))?o:"")+' class="tag" data-validated="false" data-track="tagClick">\n\t\t<a class="'+(null!=(o=g(l,"if").call(c,null!=a?g(a,"isDualTag"):a,{name:"if",hash:{},fn:n.program(13,t,0),inverse:n.program(15,t,0),data:t,loc:{start:{line:23,column:12},end:{line:23,column:69}}}))?o:"")+'" href="#">\n\t\t\t<i class="'+(null!=(o=g(l,"if").call(c,null!=a?g(a,"isDualTag"):a,{name:"if",hash:{},fn:n.program(17,t,0),inverse:n.program(19,t,0),data:t,loc:{start:{line:24,column:13},end:{line:24,column:70}}}))?o:"")+'" title="Delete"></i>\n\t\t</a>\n\t\t<a href="'+(null!=(o=g(l,"if").call(c,null!=a?g(a,"linkTagToTagsPage"):a,{name:"if",hash:{},fn:n.program(21,t,0),inverse:n.program(23,t,0),data:t,loc:{start:{line:26,column:11},end:{line:26,column:114}}}))?o:"")+'" title="'+s(typeof(r=null!=(r=g(l,"tagRaw")||(null!=a?g(a,"tagRaw"):a))?r:i)===u?r.call(c,{name:"tagRaw",hash:{},data:t,loc:{start:{line:26,column:123},end:{line:26,column:133}}}):r)+'">'+s(typeof(r=null!=(r=g(l,"tagRaw")||(null!=a?g(a,"tagRaw"):a))?r:i)===u?r.call(c,{name:"tagRaw",hash:{},data:t,loc:{start:{line:26,column:135},end:{line:26,column:145}}}):r)+"</a>\n\t</li>\n"},13:function(n,a,l,e,t){return"remove-dual-tag"},15:function(n,a,l,e,t){return"remove-tag"},17:function(n,a,l,e,t){return"delete-dual-tag"},19:function(n,a,l,e,t){return"delete-tag"},21:function(n,a,l,e,t){var o,r=null!=a?a:n.nullContext||{},c=n.hooks.helperMissing,i="function",u=n.escapeExpression,s=n.lookupProperty||function(n,a){if(Object.prototype.hasOwnProperty.call(n,a))return n[a]};return u(typeof(o=null!=(o=s(l,"tagPageURL")||(null!=a?s(a,"tagPageURL"):a))?o:c)===i?o.call(r,{name:"tagPageURL",hash:{},data:t,loc:{start:{line:26,column:36},end:{line:26,column:50}}}):o)+u(typeof(o=null!=(o=s(l,"tagWithoutSlashes")||(null!=a?s(a,"tagWithoutSlashes"):a))?o:c)===i?o.call(r,{name:"tagWithoutSlashes",hash:{},data:t,loc:{start:{line:26,column:50},end:{line:26,column:71}}}):o)},23:function(n,a,l,e,t){var o=n.lookupProperty||function(n,a){if(Object.prototype.hasOwnProperty.call(n,a))return n[a]};return n.escapeExpression((o(l,"getTagSearchUrl")||a&&o(a,"getTagSearchUrl")||n.hooks.helperMissing).call(null!=a?a:n.nullContext||{},null!=a?o(a,"tagValue"):a,{name:"getTagSearchUrl",hash:{},data:t,loc:{start:{line:26,column:79},end:{line:26,column:107}}}))},compiler:[8,">= 4.3.0"],main:function(n,a,l,e,t){var o,r=n.lookupProperty||function(n,a){if(Object.prototype.hasOwnProperty.call(n,a))return n[a]};return null!=(o=r(l,"if").call(null!=a?a:n.nullContext||{},null!=a?r(a,"isResponsiveMobilePhotoPage"):a,{name:"if",hash:{},fn:n.program(1,t,0),inverse:n.program(12,t,0),data:t,loc:{start:{line:1,column:0},end:{line:28,column:7}}}))?o:""},useData:!0}),e={};n.Array.each([],(function(a){var l=n.Template.get("hermes/"+a);l&&(e[a]=l)})),n.Template.register("hermes/sub-photo-tags-tag",(function(a,t){return(t=t||{}).partials=t.partials?n.merge(e,t.partials):e,l(a,t)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-tags-helper-text",(function(e,a){var t=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,t,l,n){var s=null!=a?a:e.nullContext||{},r=e.hooks.helperMissing,i=e.escapeExpression,o=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<div class="tags-helper-text">\n\t'+i((o(t,"intlMessage")||a&&o(a,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAGS_HELP_TEXT"},data:n,loc:{start:{line:2,column:1},end:{line:2,column:61}}}))+'\n</div>\n<a href="https://flickrhelp.com/hc/en-us/articles/4404058631700-Tag-keywords-in-Flickr" target="_blank">'+i((o(t,"intlMessage")||a&&o(a,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:"common.LEARN_MORE"},data:n,loc:{start:{line:4,column:104},end:{line:4,column:148}}}))+"</a>\n"},useData:!0}),l={};e.Array.each([],(function(a){var t=e.Template.get("hermes/"+a);t&&(l[a]=t)})),e.Template.register("hermes/tags-helper-text",(function(a,n){return(n=n||{}).partials=n.partials?e.merge(l,n.partials):l,t(a,n)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-add-tags-modal",(function(a,e){var t=a.Template.Handlebars.revive({1:function(a,e,t,n,l){return"empty"},3:function(a,e,t,n,l){var s,o=a.lookupProperty||function(a,e){if(Object.prototype.hasOwnProperty.call(a,e))return a[e]};return null!=(s=a.invokePartial(o(n,"sub-photo-tags-tag"),e,{name:"sub-photo-tags-tag",hash:{isNormalTag:!0,isResponsiveMobilePhotoPage:!0},data:l,indent:"\t\t\t",helpers:t,partials:n,decorators:a.decorators}))?s:""},5:function(a,e,t,n,l){var s,o=a.lookupProperty||function(a,e){if(Object.prototype.hasOwnProperty.call(a,e))return a[e]};return null!=(s=a.invokePartial(o(n,"sub-photo-tags-tag"),e,{name:"sub-photo-tags-tag",hash:{isMachineTag:!0,isResponsiveMobilePhotoPage:!0},data:l,indent:"\t\t\t",helpers:t,partials:n,decorators:a.decorators}))?s:""},compiler:[8,">= 4.3.0"],main:function(a,e,t,n,l){var s,o=null!=e?e:a.nullContext||{},r=a.hooks.helperMissing,i=a.escapeExpression,c=a.lookupProperty||function(a,e){if(Object.prototype.hasOwnProperty.call(a,e))return a[e]};return'<div class="search-container">\n\t<svg class="icon-search"><use xlink:href="#icon-search"></use></svg>\n\t<input type="text" class= "add-tag" placeholder="'+i((c(t,"intlMessage")||e&&c(e,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SEPARATE_TAGS_WITH_SPACE"},data:l,loc:{start:{line:3,column:50},end:{line:3,column:120}}}))+'">\n</div>\n\n<div class="tags-list-container '+(null!=(s=c(t,"if").call(o,(s=l&&c(l,"root"))&&c(s,"tagsContainerIsEmpty"),{name:"if",hash:{},fn:a.program(1,l,0),inverse:a.noop,data:l,loc:{start:{line:6,column:32},end:{line:6,column:78}}}))?s:"")+'">\n\t<h2 class="tags-empty-header">'+i((c(t,"intlMessage")||e&&c(e,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PRESS_ENTER_ADD_TAGS"},data:l,loc:{start:{line:7,column:31},end:{line:7,column:97}}}))+'</h2>\n\t<p class="tags-empty-tip">'+i((c(t,"intlMessage")||e&&c(e,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAG_TIP"},data:l,loc:{start:{line:8,column:27},end:{line:8,column:80}}}))+'</p>\n\t<ul class="tags-list tags-modal-list">\n'+(null!=(s=c(t,"each").call(o,null!=e?c(e,"removableRegularTags"):e,{name:"each",hash:{},fn:a.program(3,l,0),inverse:a.noop,data:l,loc:{start:{line:10,column:2},end:{line:12,column:11}}}))?s:"")+'\t</ul>\n\t<ul class="machine-tags-list tags-modal-list">\n'+(null!=(s=c(t,"each").call(o,null!=e?c(e,"removableMachineTags"):e,{name:"each",hash:{},fn:a.program(5,l,0),inverse:a.noop,data:l,loc:{start:{line:15,column:2},end:{line:17,column:11}}}))?s:"")+'\t</ul>\n\t<ul class="non-viewer-tags-list tags-modal-list">\n'+(null!=(s=c(t,"each").call(o,null!=e?c(e,"nonRemovableRegularTags"):e,{name:"each",hash:{},fn:a.program(3,l,0),inverse:a.noop,data:l,loc:{start:{line:20,column:2},end:{line:22,column:11}}}))?s:"")+(null!=(s=c(t,"each").call(o,null!=e?c(e,"nonRemovableMachineTags"):e,{name:"each",hash:{},fn:a.program(5,l,0),inverse:a.noop,data:l,loc:{start:{line:23,column:2},end:{line:25,column:11}}}))?s:"")+'\t</ul>\n</div>\n\n<div class="button-container">\n\t<a href="/photos/me/tags">Manage tags</a>\n\t<button class="butt done-button">'+i((c(t,"intlMessage")||e&&c(e,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"common.DONE"},data:l,loc:{start:{line:31,column:34},end:{line:31,column:72}}}))+"</button>\n</div>"},usePartial:!0,useData:!0}),n={};a.Array.each(["sub-photo-tags-tag","sub-photo-tags-tag","sub-photo-tags-tag","sub-photo-tags-tag"],(function(e){var t=a.Template.get("hermes/"+e);t&&(n[e]=t)})),a.Template.register("hermes/sub-photo-add-tags-modal",(function(e,l){return(l=l||{}).partials=l.partials?a.merge(n,l.partials):n,t(e,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-sub-photo-tags-tag","hermes-template-sub-photo-tags-tag","hermes-template-sub-photo-tags-tag","hermes-template-sub-photo-tags-tag"]});YUI.add("tag-helper",(function(e,r){e.TagHelper=class{static parse(e=""){var r;return(r=e.replace(/["“](.*?)["”]/g,((e,r)=>r=(r=r.replace(/(,)/g,((e,r)=>"{COMMA}"))).replace(/(\s)/g,((e,r)=>`{WHITESPACE-${r.charCodeAt(0)}}`))))).split(r.includes(",")?/,/:/\s+/).map(((e,r)=>e=(e=(e=e.replace(/\{WHITESPACE-(\d+)\}/g,((e,r)=>String.fromCharCode(r)))).replace(/\{COMMA\}/g,((e,r)=>","))).trim())).filter((e=>e.length>0))}static dedupe(e=[]){var r=new Map(e.reverse().map((e=>[this.clean(e),e])));return Array.from(r.values()).reverse()}static clean(e=""){return e.replace(/[\s!-\/:-@[-`]/g,"").toLowerCase()}}}),"@VERSION@",{requires:[],optionalRequires:[]});YUI.add("sub-photo-tags-tag-view",(function(t,e){var a=require("hermes-core/flog")(e),s=23;t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.context=t.clone(e.context,!0),this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.isMobileTags=e.isMobileTags||!1,this.savedTags=[],""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var e=this;return new t.FlickrPromise({photo:e.appContext.getModel("photo-models",e.photoId),photoTags:e.appContext.getModel("photo-tags-models",this.photoId),tagModel:e.appContext.getModelRegistry("tag-models"),photoAutotags:e.appContext.getModel("photo-autotags-models",e.photoId),autotagModel:e.appContext.getModelRegistry("autotag-models")}).then((function(t){e.set("photo",t.photo),e.set("photoTags",t.photoTags),e.set("tagModel",t.tagModel),e.set("photoAutotags",t.photoAutotags),e.set("autotagModel",t.autotagModel)}))},buildContainer:function(){var t,e=this.get("photo"),a=this.get("photoTags").getValue("tags"),s=e.getValue("isOwner")||e.getValue("canAddMeta"),o=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,i=[],n=[],l=!1,g=!1,r=!1,h=this.get("photoAutotags").getValue("autotags"),d=e.getValue("isOwner"),p=!1,u=!this.isMobileTags,c=this.appContext.getViewer(),m=[],v=[],f=[],T=[];if(a&&0!==(a=a.toJSON()).length)for(l=!0,t=0;t<a.length;t++)o.test(a[t].tagRaw)?(this.isResponsiveMobilePhotoPage()&&(c.nsid===a[t].tagAuthorNSID||d?f.push(a[t]):T.push(a[t])),i.push(a[t])):(this.isResponsiveMobilePhotoPage()&&(c.nsid===a[t].tagAuthorNSID||d?m.push(a[t]):v.push(a[t])),n.push(a[t]));return h&&0!==(h=h.toJSON()).length&&(g=!0,p=d?this.intlMessage({intlName:"photo-page-scrappy.PRIVATE_TAGS_OWNER_HELPER_TEXT"}):this.intlMessage({intlName:"photo-page-scrappy.PRIVATE_TAGS_FRIENDS_FAMILY_HELPER_TEXT"})),l||g||(r=!0),r&&s&&(this.get("container").addClass("empty"),this.fire("subviewViewEvent","tagsTagView:tagsEmpty")),this.templateConfig={tags:n,machineTags:i,autotags:h,viewerIsOwner:d,privateAutotagHelperText:p,canAddMeta:e.getValue("isOwner")||e.getValue("canAddMeta"),viewerNSID:this.appContext.getViewer().nsid,isOwner:e.getValue("isOwner"),autotagsEnabled:!0,showTagInfoBlock:u,linkTagToTagsPage:!0,tagPageURL:"/photos/tags/",isResponsiveMobilePhotoPage:this.isResponsiveMobilePhotoPage(),tagsContainerIsEmpty:r},this.addTagsModalTemplateConfig={removableRegularTags:m,removableMachineTags:f,nonRemovableRegularTags:v,nonRemovableMachineTags:T,viewerNSID:this.appContext.getViewer().nsid,isOwner:e.getValue("isOwner"),autotagsEnabled:!0,tagsContainerIsEmpty:r},!s&&r||this.setContainerWithTemplate("sub-photo-tags-tag-section",this.templateConfig),this},activate:function(){var e,a=this.get("photo"),s=this.get("container"),o=a.getValue("owner")||a.getValue("canAddMeta"),i=this.get("photoTags").getValue("tags"),n=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,l=[],g=s.one(".autotags-helper"),r=this;for(i&&(i=i.toJSON()),0===i.length&&this.fire("subviewViewEvent","noTags"),this.fire("subviewViewEvent","tagsLoaded",i),e=0;e<i.length;e++)n.test(i[e].tagRaw)&&l.push(i[e]);return l.length&&s.one(".machine-tags-section")&&s.one(".machine-tags-section").setStyle("display","block"),!this.isMobileTags&&o&&s.one(".show-add-tags")&&(s.one(".show-add-tags").on("click",(t=>{t.preventDefault(),this.isResponsiveMobilePhotoPage()?this.showAddTagsModal():(s.hasClass("empty")&&(s.removeClass("empty"),r.fire("subviewViewEvent","tagsTagView:tagsNotEmpty")),s.one(".add-tag").setStyle("display","block"),s.one(".add-tag").focus())})),this.setupAddTagEvents(),this.setupRollOverTagEvents(),this.setupRemoveTagEvents(),this.registerEventHandler(t.on("flickr:photo-page--new-tags-added",(function(){r.buildContainer(),r.setupRollOverTagEvents(),r.setupRemoveTagEvents()}))),this.registerEventHandler(t.on("flickr:photo-page:focus_tag_entry",(function(t){var e=r.get("container");e&&e.one(".tags-list .add-tag")&&e.one(".tags-list .add-tag").focus()}))),this.attachKeyEvent("down:84",(function(t){t.preventDefault();try{s.hasClass("empty")&&(s.removeClass("empty"),r.fire("subviewViewEvent","tagsTagView:tagsNotEmpty")),s.one(".add-tag").setStyle("display","block"),s.one(".add-tag").focus()}catch(t){}}))),!this.isMobileTags&&g&&this.registerEventHandler(g.on("click",(function(t){r.showAutotagsHelper(t)}),g)),this},setupAddTagEvents:function(t){var e=t||this.get("container"),a=this;this.registerEventHandler(e.one(".add-tag").on("keydown",(function(t){13===t.charCode||13===t.keyCode?(t.preventDefault(),this.blur()):27===t.charCode&&(t.preventDefault(),this.setAttribute("data-prevent-auto-save",!0),this.blur())}))),this.registerEventHandler(e.one(".add-tag").on("blur",(function(){var t=this,s=t.get("value");""!==s&&(t.hasAttribute("data-prevent-auto-save")?t.removeAttribute("data-prevent-auto-save"):(t.set("value",""),0===s.length&&(s='""'),'""'!==s.trim()&&""!==s.trim()?(e.one(".tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),e.one(".tags-list").all(".not-eol").removeClass("not-eol"),e.one(".machine-tags-section")&&"block"===e.one(".machine-tags-section").getStyle("display")&&(e.one(".machine-tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),e.one(".machine-tags-list").all(".not-eol").removeClass("not-eol")),a.saveTag(s,e),setTimeout((function(){t.focus()}),4)):this.set("text","")))})))},_whichTagList:function(t){var e=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,a=t||this.get("container"),s=[a.one(".machine-tags-list"),a.one(".tags-list")];return function(t){return e.test(t)?s[0]:s[1]}},saveTag:function(e,a,s=!1,o){var i,n,l,g,r=a||this.get("container"),h=this.get("tagModel"),d=this.get("photoTags").getValue("tags"),p=this.get("photoAutotags").getValue("autotags"),u=this._whichTagList(r),c=this;g=t.TagHelper.parse(e),l=g.map((function(t){return t.toLowerCase()})),i=d.getList().some((function(t){return-1!==l.indexOf(t.getValue("tagValue").toLowerCase())})),n=p.getList().some((function(t){return-1!==l.indexOf(t.getValue("autotagValue").toLowerCase())})),h.remoteCreate({photoId:[c.photoId],tags:[e]}).then((function(e){e.forEach((function(t){var e,a=t.getValue("tagRaw"),s=t.getValue("duplicateAutotagId"),o=u(a),i=o.one("[data-tag-id='"+escape(a)+"']");i.setAttribute("data-tag-id",t.getValue("id")),i.setAttribute("data-validated","true"),i.setAttribute("data-tag-might-exist","false"),i.setAttribute("data-author",t.getValue("tagAuthorNSID")),i.addClass("can-remove-tag"),s&&(e=o.one("[data-autotag-content='"+a+"']"),i.setAttribute("data-autotag-id",t.getValue("duplicateAutotagId")),e.remove(!0))})),t.all("[data-tag-might-exist='true']").set("text",c.intlMessage({intlName:"photo-page-scrappy.DUPLICATE_TAG"})).setAttribute("data-validated","true").addClass("invalid-tag"),t.all("[data-validated='false']").set("text",c.intlMessage({intlName:"photo-page-scrappy.INVALID_TAG"})).addClass("invalid-tag"),clearTimeout(c.invalidTagRemoval),c.invalidTagRemoval=setTimeout((function(){r.all(".invalid-tag").remove(!0)}),4500)}),(function(t){var e;e=r.all("[data-validated='false']"),r.all(".autotag").removeClass("hidden"),e.size()&&e.remove(),2===t.code?c.onError(c.intlMessage({intlName:"photo-page-scrappy.MAX_TAG_LIMIT"})):c.onError(c.intlMessage({intlName:"photo-page-scrappy.ERROR_ADDING_TAG"}))})),g.forEach((t=>{var e,a,l,g=u(t).show(),h=g.hasClass("machine-tags-list"),d={tagValue:t.replace(/\s/g,""),tagRaw:t,escapedTagRaw:escape(t),mightExist:i,isDualTag:n,tagWithoutSlashes:t.replace(/\//g,""),linkTagToTagsPage:!0,tagPageURL:"/photos/tags/",isResponsiveMobilePhotoPage:this.isResponsiveMobilePhotoPage(),isNewTag:!0};if(h?(t.indexOf(" ")>0?(a=t.indexOf("=")+1,l=t.substring(0,a)+'"'+t.substring(a)+'"',d.tagValue=l):d.tagValue=t,r.one(".machine-tags-section")&&"none"===r.one(".machine-tags-section").getStyle("display")&&r.one(".machine-tags-section").setStyle("display","block"),e=c.templates("sub-photo-tags-tag")(d)):(d.tagValue=t.replace(/\s/g,""),e=c.templates("sub-photo-tags-tag")(d),n&&g.one("[data-autotag-content='"+t+"']").addClass("hidden")),s)o.removeClass("hidden"),this.savedTags=this.savedTags.filter((e=>e.getAttribute("data-value")!==t));else if(this.isResponsiveMobilePhotoPage()){if(r.one(".tags-list-container").hasClass("empty")&&r.one(".tags-list-container").removeClass("empty"),!i){var p=this.savedTags.find((e=>e.getAttribute("data-value")===t));p?p.removeClass("hidden"):g.prepend(e)}}else g.append(e)})),c.setupRollOverTagEvents()},setupRemoveTagEvents:function(e){var s=e||this.get("container"),o=this.get("photoTags").getValue("tags"),i=this.get("tagModel"),n=this.get("photoAutotags").getValue("autotags"),l=this.get("autotagModel"),g={},r=s.one(".machine-tags-list"),h=this;this.registerEventHandler(s.one(".tags-list-container").delegate("click",(e=>{var d;if((d=h.isResponsiveMobilePhotoPage()?e.target.ancestor("li",!0):e.target).hasClass("remove-tag")||d.hasClass("delete-tag")||d.hasClass("remove-autotag")||d.hasClass("delete-autotag")||d.hasClass("remove-dual-tag")||d.hasClass("delete-dual-tag")){e.preventDefault();var p,u,c=e.target.ancestor(".tag",!0);c?(p=c.getAttribute("data-tag-id"),i.remoteDelete(p).then((function(){o.removeFromList(p,"id"),h.isResponsiveMobilePhotoPage()?(c.addClass("hidden"),h.savedTags.push(c)):c.remove(!0),0===o.toJSON().length&&0===n.toJSON().length?(s.addClass("empty"),h.fire("subviewViewEvent","tagsTagView:tagsEmpty")):0===o.toJSON().length&&s.one(".add-tag").setStyle("display","none")}),(function(){h.onError(h.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_TAG"}))})),d.hasClass("remove-dual-tag")||d.hasClass("delete-dual-tag")?(u=c.getAttribute("data-autotag-id"),g.photo_id=h.photoId,g.autotags=u,l.remoteDelete(g).then((function(){n.remove(u,"id")}),(function(){a.warn("deleting the corresponding autotag for this usertag failed")})),t.rapidTracker.beacon(h.name,"dualTagDeleteClick",{type:u})):t.rapidTracker.beacon(h.name,"tagDeleteClick")):(c=e.target.ancestor(".autotag",!0),u=c.getAttribute("data-autotag-id"),g.photo_id=h.photoId,g.autotags=u,l.remoteDelete(g).then((function(){n.remove(u,"id"),c.remove(!0),0===n.toJSON().length&&0===o.toJSON().length&&(s.one(".add-tag").setStyle("display","none"),s.addClass("empty"),h.fire("subviewViewEvent","tagsTagView:tagsEmpty"))}),(function(){h.onError(h.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_TAG"}))})),t.rapidTracker.beacon(h.name,"autotagDeleteClick",{type:u})),r.getDOMNode().childElementCount||s.one(".machine-tags-section")&&s.one(".machine-tags-section").setStyle("display","none"),s.one(".tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),s.one(".tags-list").all(".not-eol").removeClass("not-eol"),s.one(".machine-tags-section")&&"block"===s.one(".machine-tags-section").getStyle("display")&&(s.one(".machine-tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),s.one(".machine-tags-list").all(".not-eol").removeClass("not-eol"))}}),"ul.tags-list li:not(.hidden), ul.machine-tags-list li:not(.hidden)"))},setupRollOverTagEvents:function(){var t,e=this.get("container");this.registerEventHandler(e.all(".tags-list, .machine-tags-list").on("mouseover",(function(e){if((t=e.target.ancestor(".tag, .autotag",!0))&&t.hasClass("can-remove-tag")){var a=t.ancestor(".tags-list")?t.ancestor(".tags-list").getDOMNode().offsetLeft:t.ancestor(".machine-tags-list").getDOMNode().offsetLeft,o=t.getDOMNode().offsetLeft;(t.ancestor(".tags-list")?parseInt(t.ancestor(".tags-list").getComputedStyle("width"),10):parseInt(t.ancestor(".machine-tags-list").getComputedStyle("width"),10))-(o-a+parseInt(t.getComputedStyle("width"),10))<=s?(t.removeClass("not-eol"),t.addClass("end-of-the-line")):(t.removeClass("end-of-the-line"),t.addClass("not-eol"))}})))},showAutotagsHelper:function(e){var a=this.get("container").one(".autotags-helper-icon"),s=this.templates("tags-helper-text");new t.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,width:240,observePageResize:!0,anchorElement:a,htmlMessage:s({})}).show()},onError:function(e){return this.errorDialog=new t.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:e,darkOverlay:!0}),this.errorDialog.show(),this.errorDialog},showAddTagsModal:function(){this.addTagsModal=new t.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"photo-page-scrappy.ADD_TAGS"}),showFooter:!1,htmlMessage:this.templates("sub-photo-add-tags-modal")(this.addTagsModalTemplateConfig),classList:"sub-photo-add-tags-modal"}),this.addTagsModal.on("activated",(()=>{this.savedTags=[];var t=this.addTagsModal.get("container"),e=t.one(".done-button");this.setupRemoveTagEvents(t),this.setupAddTagEvents(t),this.registerEventHandler(t.one(".tags-list-container").delegate("click",(e=>{var a=e.currentTarget,s='"'+a.getAttribute("data-value")+'"';this.saveTag(s,t,!0,a)}),"ul.tags-list li.hidden, ul.machine-tags-list li.hidden")),e.on("click",(()=>{this.addTagsModal.close()}))})),this.addTagsModal.on("close",(()=>{this.buildContainer(),this.activate()})),this.addTagsModal.show()},isResponsiveMobilePhotoPage:function(){return this.appContext.flipper.isFlipped("enable-responsive-mobile-photo-page")&&this.appContext.viewportData.getWidth()<=700}})}),"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-tags-tag-section","hermes-template-sub-photo-tags-tag","hermes-template-tags-helper-text","hermes-template-head-meta","hermes-template-sub-photo-add-tags-modal","url-helper","tag-helper"],optionalRequires:["hermes-core"],optional:[],langBundles:["common","photo-page-scrappy"]});