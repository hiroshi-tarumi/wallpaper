YUI.add("hermes-template-head-article",(function(n,t){var l=n.Template.Handlebars.revive({1:function(n,t,l,e,o){var r,a,i=null!=t?t:n.nullContext||{},u=n.hooks.helperMissing,c="function",p=n.escapeExpression,s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return' <script type="application/ld+json">\n\t{\n\t\t"@context": "https://schema.org",\n\t\t"@type": "BlogPosting",\n\t\t"mainEntityOfPage": {\n\t\t\t"@type": "WebPage",\n\t\t\t"@id": "'+p(typeof(a=null!=(a=s(l,"url")||(null!=t?s(t,"url"):t))?a:u)===c?a.call(i,{name:"url",hash:{},data:o,loc:{start:{line:8,column:11},end:{line:8,column:18}}}):a)+'"\n\t\t},\n\t\t"headline": "'+p(typeof(a=null!=(a=s(l,"title")||(null!=t?s(t,"title"):t))?a:u)===c?a.call(i,{name:"title",hash:{},data:o,loc:{start:{line:10,column:15},end:{line:10,column:24}}}):a)+'",\n'+(null!=(r=s(l,"if").call(i,null!=t?s(t,"photoUrl"):t,{name:"if",hash:{},fn:n.program(2,o,0),inverse:n.noop,data:o,loc:{start:{line:11,column:2},end:{line:18,column:9}}}))?r:"")+(null!=(r=s(l,"if").call(i,null!=t?s(t,"ownerUrl"):t,{name:"if",hash:{},fn:n.program(7,o,0),inverse:n.noop,data:o,loc:{start:{line:19,column:2},end:{line:25,column:9}}}))?r:"")+'\t\t"publisher": {\n\t\t\t"@type": "Organization",\n\t\t\t"name": "Flickr",\n\t\t\t"logo": {\n\t\t\t\t"@type": "ImageObject",\n\t\t\t\t"url": "https://www.flickr.com/images/opensearch-flickr-logo.png",\n\t\t\t\t"width": 64,\n\t\t\t\t"height": 64\n\t\t\t}\n\t\t}'+(null!=(r=s(l,"if").call(i,null!=t?s(t,"description"):t,{name:"if",hash:{},fn:n.program(9,o,0),inverse:n.noop,data:o,loc:{start:{line:35,column:3},end:{line:36,column:41}}}))?r:"")+"\n\t}\n\t<\/script>\n"},2:function(n,t,l,e,o){var r,a,i=null!=t?t:n.nullContext||{},u=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t"image": {\n\t\t\t"@type": "ImageObject",\n\t\t\t"url": "'+n.escapeExpression("function"==typeof(a=null!=(a=u(l,"photoUrl")||(null!=t?u(t,"photoUrl"):t))?a:n.hooks.helperMissing)?a.call(i,{name:"photoUrl",hash:{},data:o,loc:{start:{line:14,column:11},end:{line:14,column:23}}}):a)+'"'+(null!=(r=u(l,"if").call(i,null!=t?u(t,"photoHeight"):t,{name:"if",hash:{},fn:n.program(3,o,0),inverse:n.noop,data:o,loc:{start:{line:14,column:24},end:{line:15,column:35}}}))?r:"")+(null!=(r=u(l,"if").call(i,null!=t?u(t,"photoWidth"):t,{name:"if",hash:{},fn:n.program(5,o,0),inverse:n.noop,data:o,loc:{start:{line:15,column:35},end:{line:16,column:33}}}))?r:"")+"\n\t\t},\n"},3:function(n,t,l,e,o){var r,a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return',\n\t\t\t"height": '+n.escapeExpression("function"==typeof(r=null!=(r=a(l,"photoHeight")||(null!=t?a(t,"photoHeight"):t))?r:n.hooks.helperMissing)?r.call(null!=t?t:n.nullContext||{},{name:"photoHeight",hash:{},data:o,loc:{start:{line:15,column:13},end:{line:15,column:28}}}):r)},5:function(n,t,l,e,o){var r,a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return',\n\t\t\t"width": '+n.escapeExpression("function"==typeof(r=null!=(r=a(l,"photoWidth")||(null!=t?a(t,"photoWidth"):t))?r:n.hooks.helperMissing)?r.call(null!=t?t:n.nullContext||{},{name:"photoWidth",hash:{},data:o,loc:{start:{line:16,column:12},end:{line:16,column:26}}}):r)},7:function(n,t,l,e,o){var r,a=null!=t?t:n.nullContext||{},i=n.hooks.helperMissing,u="function",c=n.escapeExpression,p=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t"author": {\n\t\t\t"@type": "Person",\n\t\t\t"name": "'+c(typeof(r=null!=(r=p(l,"ownerName")||(null!=t?p(t,"ownerName"):t))?r:i)===u?r.call(a,{name:"ownerName",hash:{},data:o,loc:{start:{line:22,column:12},end:{line:22,column:25}}}):r)+'",\n\t\t\t"sameAs": "'+c(typeof(r=null!=(r=p(l,"ownerUrl")||(null!=t?p(t,"ownerUrl"):t))?r:i)===u?r.call(a,{name:"ownerUrl",hash:{},data:o,loc:{start:{line:23,column:14},end:{line:23,column:26}}}):r)+'"\n\t\t},\n'},9:function(n,t,l,e,o){var r,a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return',\n\t\t"description": "'+n.escapeExpression("function"==typeof(r=null!=(r=a(l,"description")||(null!=t?a(t,"description"):t))?r:n.hooks.helperMissing)?r.call(null!=t?t:n.nullContext||{},{name:"description",hash:{},data:o,loc:{start:{line:36,column:18},end:{line:36,column:33}}}):r)+'"'},compiler:[8,">= 4.3.0"],main:function(n,t,l,e,o){var r,a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(r=a(l,"if").call(null!=t?t:n.nullContext||{},null!=t?a(t,"url"):t,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.noop,data:o,loc:{start:{line:1,column:0},end:{line:39,column:7}}}))?r:""},useData:!0}),e={};n.Array.each([],(function(t){var l=n.Template.get("hermes/"+t);l&&(e[t]=l)})),n.Template.register("hermes/head-article",(function(t,o){return(o=o||{}).partials=o.partials?n.merge(e,o.partials):e,l(t,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("gallery-page-view",(function(e,t){var i=require("hermes-core/flog")(t),o=(require("html-truncate"),50);e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){var t,i;switch(this.params=e,this.layoutPrefMap={large:"lv",justified:"jv",grid:"tv"},this.justifiedSubviewMapping={"photo-models":{name:"photo-list-gallery-photo-view",params:{}}},this.gridSubviewMapping={"photo-models":{name:"photo-list-gallery-photo-view",params:{infoBarOnHover:!0}}},this.largeSubviewMapping={"photo-models":{name:"photo-list-gallery-photo-view",params:{showOwnerIcon:!0}}},this.justifiedLayout={targetRowHeight:280,targetRowHeightTolerance:.2,containerPadding:{top:0,right:0,bottom:28,left:0},itemSpacing:{horizontal:28,vertical:28},additionalHeight:70,forceAspectRatio:void 0},this.gridLayout={targetRowHeight:160,targetRowHeightTolerance:.2,containerPadding:{top:0,right:0,bottom:28,left:0},itemSpacing:{horizontal:8,vertical:8},additionalHeight:0,forceAspectRatio:1},this.largeLayout={targetRowHeight:500,targetRowHeightTolerance:.2,containerPadding:{top:0,right:0,bottom:28,left:0},itemSpacing:{horizontal:28,vertical:28},additionalHeight:70,forceAspectRatio:void 0},this.params.layoutPref){case"jv":t=this.justifiedLayout,i=this.justifiedSubviewMapping;break;case"tv":t=this.gridLayout,i=this.gridSubviewMapping;break;default:t=this.largeLayout,i=this.largeSubviewMapping}e.photoListConfig={parentName:this.name,measureAFT:!0,contextSuffix:e.contextSuffix,paginateOnScroll:!0,maintainScrollPosition:!1,subviewMapping:Object.assign({},i),pageParams:{page:1,perPage:o},initializeWithFirstPage:!0},e.photoListConfig.modelParams={registryName:"gallery-info-models",modelIdOrAttributes:e.galleryId,collectionAttributeName:"photoList",fetchParams:{id:e.galleryId,page:1,perPage:o}},e.reorderGridConfig={layout:{maxWidth:140,itemSpacing:{horizontal:8,vertical:8}},modelParams:Object.assign({},e.photoListConfig.modelParams)},e.photoListConfig.layout=t,this.photoListConfig=e.photoListConfig,this.signedIn=this.appContext.getViewer().signedIn,this.storedEditMeta=null},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"gallery-comments-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1}},loadState:function(){var t=this,o=[];return o.push(this.appContext.getModel("gallery-info-models",{id:this.params.galleryId}).then((function(i){if(t.galleryInfoModel=i,t.personUrls=e.URLHelper.generatePersonUrls(t.galleryInfoModel.getValue("owner")),t.isGalleryOwner=t.signedIn&&t.appContext.getViewer().nsid===t.galleryInfoModel.getValue("owner").getValue("nsid"),i.getValue("primaryPhotoId"))return t.appContext.getModel("photo-models",i.getValue("primaryPhotoId")).then((function(e){if(t.primaryPhotoModel=e,t.isGalleryOwner)return t.appContext.getModelRegistry("favorite-models",{id:t.appContext.getViewer().nsid}).then((function(e){t.faveModelRegistry=e}))}))})).catch((function(e){throw i.error("Error getting gallery info",{err:e}),e}))),this.appContext.getViewer().signedIn&&o.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid).then((function(e){t.personPrefsModel=e}))),e.Promise.all(o)},buildContainer:function(){var t,i=this.galleryInfoModel.toJSON(),o="",s=this.isGalleryOwner,n=this.galleryInfoModel.getValue("photoCount")+this.galleryInfoModel.getValue("videoCount"),a=0===n,l=this.params.layoutPref||"lv";return o=s?this.intlMessage({intlName:"gallery.GALLERY_CURATED_BY_YOU",ownerUrl:i.owner.url}):this.intlMessage({intlName:"gallery.GALLERY_CURATED_BY",ownerName:e.StringHelper.escapeHtml(i.owner.username),ownerUrl:i.owner.url}),t={galleryId:this.params.galleryId,title:i.title,galleryByString:o,ownerDisplayName:i.owner.username,ownerUrl:i.owner.url,itemCount:n,itemCountString:e.IntlNumber.format(n,this.appContext.lang,1),commentCount:i.commentCount,commentCountString:e.IntlNumber.format(i.commentCount,this.appContext.lang,1),viewCount:i.viewCount,viewCountString:e.IntlNumber.format(i.viewCount,this.appContext.lang,1),photoList:i.photoList,backUrl:this.personUrls?this.personUrls.galleries+"/with/"+this.params.galleryId:"",description:i.description,shortDescription:i.description,isGalleryOwner:s,signedIn:this.signedIn,isEmpty:a,largeLayout:"lv"===l,justifiedLayout:"jv"===l,gridLayout:"tv"===l},this.setContainerWithTemplate("gallery-page-view",t),this},buildHeadContainer:function(){var t,o,s,n=this.galleryInfoModel.getValue("photoList").getList();this.primaryPhotoModel?o=this.primaryPhotoModel.getSizeToFit({width:640,height:480}):i.error("Missing primary photo model"),n&&(s=n.map((function(t){var i=t.getSizeToFit({width:1600,height:1600});return{url:e.URLHelper.addProtocolToURL(i.url),width:i.width,height:i.height}})).slice(0,6)),t=this.templates("dynamic-page-head")({title:this.galleryInfoModel.getValue("title"),description:this.galleryInfoModel.getValue("description")||this.intlMessage({intlName:"gallery.GALLERY_CURATED_BY",ownerName:this.galleryInfoModel.getValue("owner").getValue("displayname"),ownerUrl:this.galleryInfoModel.getValue("owner").getValue("url")}),url:this.galleryInfoModel.getValue("url"),embedUrl:"/galleries/"+this.galleryInfoModel.id,fullURL:e.url(this.galleryInfoModel.getValue("url")),ogType:"article",openGraphImageURL:o?e.URLHelper.addProtocolToURL(o.url):"",openGraphImageWidth:o?o.width:"",openGraphImageHeight:o?o.height:"",extraOpenGraphImages:s,ownerURL:e.url(this.galleryInfoModel.getValue("owner").getValue("url")),twitterCardType:"player"}),t+=this.templates("head-article")({title:this.galleryInfoModel.getValue("title"),url:e.url(this.galleryInfoModel.getValue("url")),ownerUrl:e.url(this.galleryInfoModel.getValue("owner").getValue("url")),ownerName:this.galleryInfoModel.getValue("owner").getValue("displayname"),photoUrl:o?e.URLHelper.addProtocolToURL(o.url):"",photoHeight:o?o.height:"",photoWidth:o?o.width:"",description:this.galleryInfoModel.getValue("description")||this.intlMessage({intlName:"gallery.GALLERY_CURATED_BY",ownerName:this.galleryInfoModel.getValue("owner").getValue("displayname"),ownerUrl:this.galleryInfoModel.getValue("owner").getValue("url")})}),t+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),YUI.Env.isServer&&this.set("headContainer",t)},activate:function(){var t,i,s=this.get("container");return this.detailsSection=s.one(".details-section"),this.titleNode=this.detailsSection.one("h1"),this.descripNode=this.detailsSection.one(".description"),this.descripContentNode=this.descripNode.one("p"),this.readMoreButton=this.detailsSection.one(".read-more-button"),this.readLessButton=this.detailsSection.one(".read-less-button"),this.commentStat=this.detailsSection.one(".stat.comment-count"),this.itemStat=this.detailsSection.one(".stat.photo-count"),this.reorderButton=s.one(".reorder-button"),this.addPhotoButton=s.one(".add-photo-button"),this.emptyAddButton=s.one(".empty-add-button"),this.photosSection=s.one(".photos-section"),this.gridLayoutButton=s.one(".layout-tabs .grid"),this.justifiedLayoutButton=s.one(".layout-tabs .justified"),this.largeLayoutButton=s.one(".layout-tabs .large"),this.photosSection=s.one(".photos-section"),this.photoListContainer=s.one(".photo-list-container"),this.photoList=this.subviews["photo-list-view"],this.bottomCommentsView=this.subviews["gallery-comments-view"],this.changeDescription(this.galleryInfoModel.getValue("description")),this.registerEventHandler(this.readMoreButton.on(["click","key"],this.handleReadMoreClick.bind(this),"down:13")),this.registerEventHandler(this.readLessButton.on(["click","key"],this.handleReadLessClick.bind(this),"down:13")),this.registerEventHandler(s.one(".actions").delegate("click",this.handleActionClick.bind(this),".action")),this.registerEventHandler(s.one(".actions").delegate("key",this.handleActionClick.bind(this),"down:13",".action")),this.registerEventHandler(this.commentStat.on(["click","key"],this.handleCommentClick.bind(this),"down:13")),this.registerEventHandler(this.galleryInfoModel.on("valuesChanged",this.handleGalleryModelValuesChanged.bind(this))),this.registerEventHandler(s.one(".layout-tabs").delegate("click",this.handleLayoutClick.bind(this),".tab")),this.registerEventHandler(e.on("galleryPhotoList:deletePhoto",this.handleDeletePhoto.bind(this))),this.registerEventHandler(e.on("galleryPhotoList:refreshPhotoList",this.resetToFirstPage.bind(this))),this.reorderButton&&this.registerEventHandler(this.reorderButton.on("click",this.handleReorderClick.bind(this))),this.addPhotoButton&&this.registerEventHandler(this.addPhotoButton.on("click",this.handleAddPhotoClick.bind(this))),this.emptyAddButton&&this.registerEventHandler(this.emptyAddButton.on("click",this.handleAddPhotoClick.bind(this))),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.handleResize.bind(this))),t=this.galleryInfoModel.getValue("photoList").getPageOf({id:this.params.withPhotoId},o),this.params.withPhotoId&&-1!==t&&(i=this.galleryInfoModel.getValue("photoList").getList().slice(0,t*o),this.photoList.setItems(i,i.length<this.galleryInfoModel.getValue("photoList").totalItems),this.photoList.scrollToId(this.params.withPhotoId)),0===this.galleryInfoModel.getValue("photoList").totalItems&&this.photoList.hide(),this.isGalleryOwner||this.appContext.getViewCounter().recordGalleryView({galleryOwnerID:this.galleryInfoModel.getValue("owner").id,galleryID:this.galleryInfoModel.id,referrer:this.appContext.getReferrer()}),this},handleReadMoreClick:function(){this.toggleLongDescription(!0),this.readLessButton.focus()},handleReadLessClick:function(){this.toggleLongDescription(!1),this.readMoreButton.focus()},handleResize:function(){this.changeDescription(this.galleryInfoModel.getValue("description"))},toggleLongDescription:function(e){this.descripNode.toggleClass("short",!e),e?(this.descripContentNode.setHTML(this.longDescription),this.readMoreButton.toggleClass("hidden",!0),this.readLessButton.toggleClass("hidden",!1)):(this.descripContentNode.setHTML(this.description),this.readMoreButton.toggleClass("hidden",!1),this.readLessButton.toggleClass("hidden",!0))},handleActionClick:function(e){e.target.ancestor(".action.edit",!0)?this.handleEditClick(e):e.target.ancestor(".action.comment",!0)?this.handleCommentClick(e):e.target.ancestor(".action.share",!0)&&this.handleShareClick(e)},handleEditClick:function(){this.showEditModal()},handleCommentClick:function(e){this.showCommentModal()},handleShareClick:function(t){e.rapidTracker.beacon(this.name,"galleryPageShareClick"),this.showShareModal(t.target)},showEditModal:function(){var t=this,i=new e.Views["gallery-edit-view"]({galleryId:this.params.galleryId,title:this.storedEditMeta?this.storedEditMeta.title:this.galleryInfoModel.getValue("title"),description:this.storedEditMeta?this.storedEditMeta.description:this.galleryInfoModel.getValue("description"),coverPhotoId:this.storedCoverPhotoId?this.storedCoverPhotoId:this.galleryInfoModel.getValue("primaryPhotoId")});this.storedEditMeta=null,this.editModal=new e.Views.FluidModal({appContext:this.appContext,subview:i,dismissOnOverlayClick:!0,classList:["gallery-edit-modal"],width:600,focusOnFirstTabPress:!1,hasSubviewConfigRefactor:!0}),this.editModal.show(),i.registerEventHandler(e.on("galleryEdit:close",(function(e){t.editModal.close(e)}))),i.registerEventHandler(e.on("galleryEdit:reposition",(function(e){t.editModal.isClosed||t.editModal.reposition()}))),i.registerEventHandler(e.on("galleryEdit:coverPhotoClicked",(function(e){var i=t.storedCoverPhotoId;t.storedEditMeta=e.storedEditMeta,t.editModal.close(),setTimeout((function(){t.storedCoverPhotoId=i,t.showPhotoPicker()}),1)}))),i.registerEventHandler(e.on("galleryEdit:deleted",(function(i){e.config.win.location=t.personUrls?t.personUrls.galleries:""}))),this.editModal.on("close",(function(){t.storedCoverPhotoId=null}))},showCommentModal:function(){var t=this,i=new e.Views["gallery-comments-view"]({galleryId:this.params.galleryId,isScrollable:!0,hasHeader:!0,appContext:this.appContext});this.commentsModal=new e.Views.FluidModal({appContext:this.appContext,subview:i,dismissOnOverlayClick:!0,width:600,classList:["gallery-comments-modal"],hasSubviewConfigRefactor:!0}),this.commentsModal.show(),this.commentsModal.on("close",(function(){t.bottomCommentsView.resetComments()})),this.registerEventHandler(e.on("addComment:showingSignupModal",(function(e){t.commentsModal.close(e)}))),this.registerEventHandler(e.on("commentsModal:reposition",(function(e){t.commentsModal.isClosed||t.commentsModal.reposition()})))},showShareModal:function(t){var i=new e.Views["fluid-share-gallery-view"]({appContext:this.appContext,galleryId:this.params.galleryId,nsid:this.galleryInfoModel.getValue("owner").nsid});i.initialize().then((function(){return i.prepareModal(t)}))},handleGalleryModelValuesChanged:function(t){var i;t.title&&this.titleNode.set("text",t.title.newVal),t.description&&this.changeDescription(t.description.newVal),t.photoList&&(i=this.galleryInfoModel.getValue("photoList").totalItems,this.itemStat.set("text",this.intlMessage({intlName:"common.ITEM_COUNT_FORMATTED",itemCount:i,countString:e.IntlNumber.format(i,this.appContext.lang,1)})),0===i?(this.photoList.hide(),this.photosSection.addClass("empty")):this.photoList.isHidden&&(this.photoList.show(),this.photosSection.removeClass("empty"),this.resetToFirstPage())),t.commentCount&&this.commentStat.set("text",this.intlMessage({intlName:"common.COMMENT_COUNT_FORMATTED",commentCount:t.commentCount.newVal,countString:e.IntlNumber.format(t.commentCount.newVal,this.appContext.lang,1)}))},changeDescription:function(e){this.description=e,this.description?(this.descripNode.removeClass("hidden"),this.longDescription=e.replace(/(\r\n|\n|\r)/gm,"<br>"),this.toggleLongDescription(!1),this.descripContentNode.setHTML(this.longDescription),this.descripContentNode.getDOMNode().scrollHeight>this.descripContentNode.getDOMNode().clientHeight?(this.descripNode.toggleClass("short-plus",!0),this.descripContentNode.getDOMNode().scrollHeight>this.descripContentNode.getDOMNode().clientHeight?(this.descripNode.toggleClass("no-read-more",!1),this.descripNode.toggleClass("short-plus",!1),this.descripContentNode.setHTML(this.description)):this.descripNode.toggleClass("no-read-more",!0)):this.descripNode.toggleClass("no-read-more",!0)):this.descripNode.addClass("hidden")},showPhotoPicker:function(){var t=this,i={hasUploadCapabilities:!1,appContext:this.appContext,publicOnlyPhotos:!0,galleryId:this.params.galleryId,enableVideos:!0};i.defaultSelected={id:this.params.galleryId,title:this.intlMessage({intlName:"context.GALLERY_CONTEXT_TITLE"}),type:"gallery"};var o=[{id:"gallery",name:this.intlMessage({intlName:"context.GALLERY_CONTEXT_TITLE"}),value:"gallery",selected:!0}];return this.appContext.getModel("photo-models",this.galleryInfoModel.getValue("primaryPhotoId")).then((function(s){i.preSelectedPhotos=[s],t.photoPicker=new e.Views.FluidModal({appContext:t.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!1,showBodyLines:!0,handleAction:!1,showCancelButton:!1,showCancelX:!0,navBarView:new e.Views["fluid-modal-nav-bar-view"]({appContext:t.appContext,links:o,enableSearch:!1}),actionButtonLabel:t.intlMessage({intlName:"common.SELECT"}),actionButtonDisabled:!1,subview:new e.Views["photo-selector-view"](i),width:Math.round(.8*Math.max(1280,e.config.win.innerWidth)),height:Math.round(e.config.win.innerHeight-60),fullWindow:!0,classList:"photo-selector gallery-coverphoto-selector"}),t.photoPicker.show(),t.photoPicker.on("actionClick",(function(e){var i=t.photoPicker.get("subview").get("selected");t.storedCoverPhotoId=i,t.photoPicker.close()})),t.photoPicker.registerEventHandler(e.on("photoSelector:selected",(function(e){t.photoPicker.enableActionButton()}))),t.photoPicker.registerEventHandler(e.on("photoSelector:unselected",(function(e){t.photoPicker.disableActionButton()}))),t.photoPicker.on("close",(function(){setTimeout((function(){t.showEditModal()}),1)}))}))},handleLayoutClick:function(t){t.target.ancestor(".grid",!0)?(e.rapidTracker.beacon(this.name,"galleryLayoutGridClick"),this.changePhotoListLayout("grid")):t.target.ancestor(".justified",!0)?(e.rapidTracker.beacon(this.name,"galleryLayoutJustifiedClick"),this.changePhotoListLayout("justified")):t.target.ancestor(".large",!0)&&(e.rapidTracker.beacon(this.name,"galleryLayoutLargeClick"),this.changePhotoListLayout("large"))},changePhotoListLayout:function(e){var t=this;this.photoList&&this.photoList.photoListLayout,this.photoList&&this.photoList.subviewMapping,Object.assign({},this.params.photoListConfig);this.setLayoutTabSelected(e),"grid"===e?(this.photoList.show(),Object.assign(this.photoList.photoListLayout,this.gridLayout),Object.assign(this.photoList.subviewMapping,this.gridSubviewMapping),this.resetToFirstPage(),setTimeout((function(){t.photoList.loadMore("bottom")}),0)):"justified"===e?(this.photoList.show(),Object.assign(this.photoList.photoListLayout,this.justifiedLayout),Object.assign(this.photoList.subviewMapping,this.justifiedSubviewMapping),this.resetToFirstPage()):"large"===e&&(this.photoList.show(),Object.assign(this.photoList.photoListLayout,this.largeLayout),Object.assign(this.photoList.subviewMapping,this.largeSubviewMapping),this.resetToFirstPage())},setLayoutTabSelected:function(e){this.gridLayoutButton.toggleClass("selected","grid"===e),this.justifiedLayoutButton.toggleClass("selected","justified"===e),this.largeLayoutButton.toggleClass("selected","large"===e),this.personPrefsModel&&(this.personPrefsModel.setValues({galleryViewLayoutPref:this.layoutPrefMap[e]}),this.personPrefsModel.remoteUpdate())},handleDeletePhoto:function(e){this.galleryInfoModel.removePhotoRemote(e.photoId)},handleReorderClick:function(){this.showReorderModal()},showReorderModal:function(){var t=this,i=new e.Views["reorder-grid-modal-view"]({reorderGridConfig:this.params.reorderGridConfig,appContext:this.appContext});this.reorderModal=new e.Views.FluidModal({appContext:this.appContext,subview:i,dismissOnOverlayClick:!1,classList:["reorder-grid-modal"],width:800,hasSubviewConfigRefactor:!0}),this.reorderModal.show(),i.registerEventHandler(e.on("reorderGridModal:close",(function(e){t.reorderModal.close(e),t.resetToFirstPage()}))),i.registerEventHandler(e.on("reorderGridModal:doneClicked",(function(i){e.rapidTracker.beacon(t.name,"galleryReorderSaveClick")})))},refetchPersonGalleries:function(){var e=this;return this.appContext.getModelRegistry("person-galleries-models").then((function(t){return t.remove(e.galleryInfoModel.getValue("owner").id),t.get(e.galleryInfoModel.getValue("owner").id)}))},resetToFirstPage:function(){var e=this.galleryInfoModel.getValue("photoList");this.photoList.lowestPageInView=0,this.photoList.highestPageInView=0,this.photoList.setItems(e.getList().slice(0,o),o<e.totalItems)},handleAddPhotoClick:function(){this.showFavoritesPhotoPicker()},showFavoritesPhotoPicker:function(){var t=this,o=this.galleryInfoModel.getValue("photoCount")+this.galleryInfoModel.getValue("videoCount"),s=e.config.flickr.galleries.photo_limit,n=s-o>=0?s-o:0,a="",l={hasUploadCapabilities:!1,appContext:this.appContext,publicOnlyPhotos:!0,galleryId:this.params.galleryId,enableMultiSelect:!0,multiSelectLimit:n,enableVideos:!0};l.defaultSelected={id:this.appContext.getViewer().nsid+"-"+this.params.galleryId,title:this.intlMessage({intlName:"common.FAVES_SHORT"}),type:"galleryFaves"};var r=[{id:"galleryFaves",name:this.intlMessage({intlName:"common.FAVES_SHORT"}),value:"galleryFaves",selected:!0}];a=0===n?this.intlMessage({intlName:"gallery.GALLERY_FULL_CANT_ADD"}):this.intlMessage({intlName:"gallery.GALLERY_CHOOSE_PHOTOS_LIMIT",limit:n}),this.favePhotoPicker=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!1,showBodyLines:!0,handleAction:!1,showCancelButton:!0,showCancelX:!0,navBarView:new e.Views["fluid-modal-nav-bar-view"]({appContext:this.appContext,links:r,enableSearch:!1}),actionButtonLabel:this.intlMessage({intlName:"common.SELECT"}),actionButtonDisabled:!1,subview:new e.Views["photo-selector-view"](l),width:Math.round(.8*Math.max(1280,e.config.win.innerWidth)),height:Math.round(e.config.win.innerHeight-60),fullWindow:!0,classList:"photo-selector gallery-faves-selector",buttonFlavorText:a,flexLayout:!0}),this.faveModelRegistry&&this.faveModelRegistry.remove(this.appContext.getViewer().nsid),this.favePhotoPicker.show(),this.favePhotoPicker.on("actionClick",(function(o){var s=t.favePhotoPicker.get("subview").get("selectionModel").getValue("photos").getList().map((function(e){return e.id}));return e.rapidTracker.beacon(t.name,"galleryFavesAddClick"),t.favePhotoPicker.disableActionButton(),t.galleryInfoModel.addPhotoRemote(s).then((function(e){t.resetToFirstPage(),t.favePhotoPicker.close()})).catch((function(e){throw i.error("Error adding photos to gallery",{err:e}),t.favePhotoPicker.enableActionButton(),e}))})),this.favePhotoPicker.registerEventHandler(e.on("photoSelector:selected",(function(e){t.favePhotoPicker.enableActionButton()}))),this.favePhotoPicker.registerEventHandler(e.on("photoSelector:unselected",(function(e){0===t.favePhotoPicker.get("subview").get("selectionModel").getValue("photos").size()&&t.favePhotoPicker.disableActionButton()}))),this.favePhotoPicker.registerEventHandler(e.on("photoSelector:updateCount",function(t){var i=e.one(".photo-selector .flavor-text");i&&(0===t.count?i.setHTML(this.intlMessage({intlName:"gallery.GALLERY_FULL_CANT_ADD"})):i.setHTML(this.intlMessage({intlName:"gallery.GALLERY_CHOOSE_PHOTOS_LIMIT",limit:t.count})))}.bind(this)))}},{ATTRS:{}})}),"@VERSION@",{requires:["flickr-view","global-nav-view","footer-full-view","photo-list-view","photo-list-photo-edit-interaction-view","fluid-share-photo-view","fluid-share-gallery-view","gallery-edit-view","gallery-comments-view","reorder-grid-modal-view","photo-selector-view","hermes-template-gallery-page-view","hermes-template-head-meta","hermes-template-dynamic-page-head","hermes-template-head-article","url-helper","string-helper","url"],optionalRequires:["hermes-core"],langBundles:["gallery","header","share-modal","common","stats","context","search","photo-editor","reorder"]});YUI.add("hermes-lang-context",(function(T,e){T.Intl.add("hermes/context","en-US",{CONTACTS_CONTEXT_TITLE:[{type:0,value:"Contacts"}],CONTACTS_CONTEXT_TYPE:[{type:0,value:"contacts"}],EXPLORE_CONTEXT_TITLE:[{type:0,value:"Explore"}],EXPLORE_CONTEXT_TYPE:[{type:0,value:"explore"}],FAVORITES_CONTEXT_TITLE:[{type:0,value:"Favorites"}],FAVORITES_CONTEXT_TYPE:[{type:0,value:"favorites"}],GALLERY_CONTEXT_TITLE:[{type:0,value:"Gallery"}],GALLERY_CONTEXT_TYPE:[{type:0,value:"gallery"}],GROUP_CONTEXT_TITLE:[{type:0,value:"Group"}],GROUP_CONTEXT_TYPE:[{type:0,value:"group"}],PHOTO_LIST_CONTEXT_TITLE:[{type:0,value:"Photo list"}],PHOTO_LIST_CONTEXT_TYPE:[{type:0,value:"photo list"}],PHOTOS_OF_CONTEXT_TITLE:[{type:0,value:"Photos of"}],PHOTOS_OF_CONTEXT_TYPE:[{type:0,value:"photos of"}],PHOTOSTREAM_CONTEXT_TITLE:[{type:0,value:"Photostream"}],PHOTOSTREAM_CONTEXT_TYPE:[{type:0,value:"photostream"}],RELATED_FAVORITES_CONTEXT_TITLE:[{type:0,value:"Related favorites"}],RELATED_FAVORITES_CONTEXT_TYPE:[{type:0,value:"related favorites"}],SET_CONTEXT_TITLE:[{type:0,value:"Set"}],SET_CONTEXT_TYPE:[{type:0,value:"set"}],LOADING:[{type:0,value:"loading"}]})}),"@VERSION@",{requires:["intl"]});YUI.add("gallery-page-route",(function(e){function a(e){a.superclass.constructor.call(this,e)}e.Routes[this.name]=a,e.extend(a,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(a,l){var t=this,r=a.params&&a.params.photo_id,o={id:a.params.gallery_id},i={galleryId:a.params.gallery_id,withPhotoId:r},s=a.params.nsid_or_path_alias,n=[];return n.push(this.appContext.getModel("gallery-info-models",o)),(this.appContext.getViewer().signedIn||a.probableUser)&&n.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().signedIn?this.appContext.getViewer().nsid:a.probableUser)),e.Promise.all(n).then((function(l){var r=l[0],o=l[1];if(r.getValue("owner").getValue("pathAlias")&&r.getValue("owner").getValue("pathAlias")===s)i.contextSuffix="gallery-"+r.getValue("owner").getValue("pathAlias")+"-"+a.params.gallery_id;else{if(r.getValue("owner").getValue("id")!==s)return t.displayRouteErrors(a,new e.RouteError(404,t.intlMessage({intlName:"common.404_GALLERY_NONEXISTENT"}),{modelType:"person-galleries-models",modelID:t.getNSIDOrPathAlias(s)}));i.contextSuffix="gallery-"+r.getValue("owner").getValue("id")+"-"+a.params.gallery_id}return o&&(i.layoutPref=o.getValue("galleryViewLayoutPref")),e.Promise.resolve({view:"gallery-page-view",title:r.getValue("title"),params:i})})).catch((function(l){return t.displayRouteErrors(a,new e.RouteError(404,t.intlMessage({intlName:"common.404_GALLERY_NONEXISTENT"}),{modelType:"person-galleries-models",modelID:t.getNSIDOrPathAlias(s)}))}))}}),e.mix(a.prototype,e.Localizable)}),"@VERSION@",{requires:["flickr-route","flickr-promise","gallery-page-view"],langBundles:["common"]});