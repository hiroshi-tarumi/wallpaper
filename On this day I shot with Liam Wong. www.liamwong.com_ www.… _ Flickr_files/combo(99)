YUI.add("photo-list-subview",(function(e,t){var r=require("hermes-core/type-validator"),o=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.PhotoListSubview=e.Base.create(this.name,e.FlickrView,[],{downloadCacheAndSetImage:function(){e.fluid.loadImage(this.get("photoUrl"),{timeout:1e3,retry:!0}).then(function(e){this.handleImageLoad(!0,e)}.bind(this),function(e){this.handleImageLoad(!1,e+"?retry="+Date.now())}.bind(this))},handleImageLoad:function(t,r){var o=this.get("photoContainer");o.setStyle("backgroundImage","url("+r+")"),t||o.setStyle("backgroundColor","#eee"),this.get("model").getValue("needsInterstitial")&&o.addClass("restricted-image"),e.fluid.chill((function(){this.fire(t?"loaded":"loadError")}),this)},updateGeometry:function(e){e?this.set("layoutItem",e):e=this.get("layoutItem"),this.updateNodeGeometry(e,this.get("container"))},updateNodeGeometry:function(t,r){YUI.Env.isServer?r.setStyles({transform:"translate("+t.geometry.left+"px, "+t.geometry.top+"px)","-webkit-transform":"translate("+t.geometry.left+"px, "+t.geometry.top+"px)","-ms-transform":"translate("+t.geometry.left+"px, "+t.geometry.top+"px)"}):e.fluid.setStylePrefixed("transform","translate("+t.geometry.left+"px, "+t.geometry.top+"px)",r),t.forcedAspectRatio&&r.addClass("forced-aspect-ratio"),r.setStyles({width:t.geometry.width+"px",height:t.geometry.height+"px"})}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(e,t){return r.photoId(e)}},layoutItem:{validator:function(e,t){return"object"==typeof e&&e.hasOwnProperty("aspectRatio")&&e.hasOwnProperty("geometry")&&"object"==typeof e.geometry&&e.geometry.hasOwnProperty("width")&&e.geometry.hasOwnProperty("height")&&e.geometry.hasOwnProperty("top")&&e.geometry.hasOwnProperty("left")&&e.hasOwnProperty("isAwake")}},listModelParams:{writeOnce:"initOnly"},photoUrl:{value:"/images/spaceball.gif",getter:function(e,t){var r=this.get("model"),o=this.get("layoutItem");return r.getSizeToFit({width:o.geometry.width*this.get("photoContainerSize"),height:o.geometry.height*this.get("photoContainerSize")},{includeSquare:!1}).url}},linkedPageUrl:{writeOnce:!0,validator:function(t,r){return e.AttributeHelpers.validateString(t)}},model:{value:null},photoContainer:{readOnly:!0,derivedBy:["container"],getter:function(e){return YUI.Env.isServer?(o.warn("Cannot access photoContainer on the server; set values in the template instead. Falling back to view container."),this.get("container")):this.get("container").one(".photo")}},photoContainerSize:{value:1},measureAFT:{value:!1,validator:function(t,r){return e.AttributeHelpers.validateBoolean(t)}}}})}),"@VERSION@",{requires:["flickr-view","attribute-helpers"],optionalRequires:["fluid","hermes-core"]});YUI.add("hermes-template-gallery-page-remark-view",(function(n,e){var l=n.Template.Handlebars.revive({1:function(n,e,l,a,t){var r,i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t<span role="button" class="edit-button'+(null!=(r=i(l,"if").call(null!=e?e:n.nullContext||{},null!=e?i(e,"remark"):e,{name:"if",hash:{},fn:n.noop,inverse:n.program(2,t,0),data:t,loc:{start:{line:5,column:40},end:{line:5,column:68}}}))?r:"")+'">\n\t\t\t<svg class="icon icon-edit"><use xlink:href="#icon-edit"></use></svg>\n\t\t</span>\n'},2:function(n,e,l,a,t){return" hidden"},4:function(n,e,l,a,t){var r,i,o=null!=e?e:n.nullContext||{},s=n.hooks.helperMissing,u=n.escapeExpression,c=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t<div class="remark-edit-container'+(null!=(r=c(l,"if").call(o,null!=e?c(e,"remark"):e,{name:"if",hash:{},fn:n.program(2,t,0),inverse:n.noop,data:t,loc:{start:{line:15,column:34},end:{line:15,column:62}}}))?r:"")+'">\n\t\t<textarea placeholder="'+u((c(l,"intlMessage")||e&&c(e,"intlMessage")||s).call(o,{name:"intlMessage",hash:{mediaType:null!=(r=null!=e?c(e,"photo"):e)?c(r,"mediaType"):r,intlName:"gallery.GALLERY_REMARK_WHY"},data:t,loc:{start:{line:16,column:25},end:{line:16,column:104}}}))+'">'+u("function"==typeof(i=null!=(i=c(l,"remark")||(null!=e?c(e,"remark"):e))?i:s)?i.call(o,{name:"remark",hash:{},data:t,loc:{start:{line:16,column:106},end:{line:16,column:116}}}):i)+'</textarea>\n\t\t<div class="button-area">\n\t\t\t<button type="button" class="alt mini cancel remark-button">'+u((c(l,"intlMessage")||e&&c(e,"intlMessage")||s).call(o,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:t,loc:{start:{line:18,column:63},end:{line:18,column:103}}}))+'</button>\n\t\t\t<button type="button" class="mini action remark-button">'+u((c(l,"intlMessage")||e&&c(e,"intlMessage")||s).call(o,{name:"intlMessage",hash:{intlName:"common.SAVE"},data:t,loc:{start:{line:19,column:59},end:{line:19,column:97}}}))+"</button>\n\t\t</div>\n\t</div>\n"},compiler:[8,">= 4.3.0"],main:function(n,e,l,a,t){var r,i=null!=e?e:n.nullContext||{},o=n.hooks.helperMissing,s=n.escapeExpression,u=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<div class="remark-container">\n\t<header>\n\t\t<h1>'+s((u(l,"intlMessage")||e&&u(e,"intlMessage")||o).call(i,{name:"intlMessage",hash:{ownerName:null!=(r=null!=(r=null!=e?u(e,"gallery"):e)?u(r,"owner"):r)?u(r,"displayname"):r,intlName:"gallery.GALLERY_REMARK_OWNER_SAYS"},data:t,loc:{start:{line:3,column:6},end:{line:3,column:102}}}))+"</h1>\n"+(null!=(r=u(l,"if").call(i,null!=e?u(e,"isGalleryOwner"):e,{name:"if",hash:{},fn:n.program(1,t,0),inverse:n.noop,data:t,loc:{start:{line:4,column:2},end:{line:8,column:9}}}))?r:"")+'\t</header>\n\n\t<p class="remark-content-container'+(null!=(r=u(l,"if").call(i,null!=e?u(e,"remark"):e,{name:"if",hash:{},fn:n.noop,inverse:n.program(2,t,0),data:t,loc:{start:{line:11,column:35},end:{line:11,column:63}}}))?r:"")+'">\n\t\t'+s((u(l,"renderTrustedMarkupWithLineBreaks")||e&&u(e,"renderTrustedMarkupWithLineBreaks")||o).call(i,null!=e?u(e,"remark"):e,{name:"renderTrustedMarkupWithLineBreaks",hash:{},data:t,loc:{start:{line:12,column:2},end:{line:12,column:46}}}))+"\n\t</p>\n"+(null!=(r=u(l,"if").call(i,null!=e?u(e,"isGalleryOwner"):e,{name:"if",hash:{},fn:n.program(4,t,0),inverse:n.noop,data:t,loc:{start:{line:14,column:1},end:{line:22,column:8}}}))?r:"")+"</div>\n"},useData:!0}),a={};n.Array.each([],(function(e){var l=n.Template.get("hermes/"+e);l&&(a[e]=l)})),n.Template.register("hermes/gallery-page-remark-view",(function(e,t){return(t=t||{}).partials=t.partials?n.merge(a,t.partials):a,l(e,t)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("gallery-page-remark-view",(function(e,t){e.namespace("Views")[this.name]=e.Base.create("gallery-page-remark-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.signedIn=this.appContext.getViewer().signedIn},loadState:function(){return e.Promise.all([this.appContext.getModel("gallery-info-models",this.params.galleryId).then(function(e){this.galleryInfoModel=e}.bind(this)),this.appContext.getModel("gallery-photo-models",this.params.galleryId+"-"+this.params.photoId).then(function(e){this.galleryPhotoModel=e}.bind(this)),this.appContext.getModel("photo-models",this.params.photoId).then(function(e){this.photoModel=e}.bind(this))])},buildContainer:function(){var e,t=this.galleryInfoModel.toJSON(),i=this.galleryPhotoModel.getValue("remark");this.isGalleryOwner=this.signedIn&&this.appContext.getViewer().nsid===t.owner.nsid,e={id:this.params.id,content:this.params.content,isSignedIn:this.signedIn,isGalleryOwner:this.isGalleryOwner,gallery:t,remark:i||"",photo:{mediaType:this.photoModel.getValue("mediaType")}},this.setContainerWithTemplate("gallery-page-remark-view",e)},activate:function(){var t=this,i=this.get("container");this.editButton=i.one(".edit-button"),this.editContainer=i.one(".remark-edit-container"),this.contentContainer=i.one(".remark-content-container"),this.editSaveButton=i.one(".remark-button.action"),this.editCancelButton=i.one(".remark-button.cancel"),this.isGalleryOwner&&(this.editTextArea=this.editContainer.one("textarea"),this.editContainer.hasClass("hidden")||setTimeout((function(){t.editTextArea.focus()}),1),this.registerEventHandler(this.editButton.on("click",this.handleEditClick.bind(this))),this.registerEventHandler(this.editSaveButton.on("click",this.handleEditSaveClick.bind(this))),this.registerEventHandler(this.editCancelButton.on("click",this.handleEditCancelClick.bind(this)))),e.fire("galleryPageRemark:reposition")},handleEditClick:function(){this.showEdit(!0)},handleEditSaveClick:function(){var t=this,i=this.editTextArea.get("value");e.rapidTracker.beacon(this.name,"galleryPhotoRemarkSaveClick"),this.editSaveButton.setAttribute("disabled"),this.galleryPhotoModel.updateRemarkRemote(i).then((function(i){t.galleryPhotoModel.setValue("remark",i),e.fire("galleryPageRemark:close")})).catch((function(e){t.editSaveButton.removeAttribute("disabled")}))},handleEditCancelClick:function(){e.fire("galleryPageRemark:close")},showEdit:function(t){this.editContainer.toggleClass("hidden",!t),this.contentContainer.toggleClass("hidden",t),this.editButton.toggleClass("hidden",t),e.fire("galleryPageRemark:reposition"),t&&(this.editTextArea.focus(),this.editTextArea.select())}})}),"@VERSION@",{requires:["hermes-template-gallery-page-remark-view"],langBundles:["common","relative-dates","gallery"]});YUI.add("hermes-template-photo-list-gallery-photo-view",(function(n,t){var l=n.Template.Handlebars.revive({1:function(n,t,l,e,o){return" info-bar-on-hover"},3:function(n,t,l,e,o){return" restricted-image"},5:function(n,t,l,e,o){return" is-video"},7:function(n,t,l,e,o){return" has-descriptions"},9:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=n.invokePartial(r(e,"photo-card-overlay-icon"),t,{name:"photo-card-overlay-icon",hash:{type:"video"},data:o,indent:"\t\t\t",helpers:l,partials:e,decorators:n.decorators}))?a:""},11:function(n,t,l,e,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t<div class="remove-x-container invisible">\n\t\t\t<div class="remove-x-button" title="'+n.escapeExpression((a(l,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"gallery.REMOVE_FROM_GALLERY"},data:o,loc:{start:{line:13,column:39},end:{line:13,column:93}}}))+'">\n\t\t\t\t<svg class="icon icon-close"><use xlink:href="#icon-close"></use></svg>\n\t\t\t</div>\n\t\t</div>\n'},13:function(n,t,l,e,o){var a,r=null!=t?t:n.nullContext||{},i=n.hooks.helperMissing,s=n.escapeExpression,u=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t<div class="remark-container invisible'+(null!=(a=u(l,"if").call(r,null!=t?u(t,"isGalleryOwner"):t,{name:"if",hash:{},fn:n.noop,inverse:n.program(14,o,0),data:o,loc:{start:{line:19,column:40},end:{line:19,column:97}}}))?a:"")+(null!=(a=u(l,"if").call(r,null!=t?u(t,"remark"):t,{name:"if",hash:{},fn:n.program(17,o,0),inverse:n.noop,data:o,loc:{start:{line:19,column:97},end:{line:19,column:126}}}))?a:"")+'">\n\t\t\t<span class="remark-line-container">\n\t\t\t\t<div class="remark-line'+(null!=(a=u(l,"if").call(r,null!=t?u(t,"remark"):t,{name:"if",hash:{},fn:n.noop,inverse:n.program(15,o,0),data:o,loc:{start:{line:21,column:27},end:{line:21,column:55}}}))?a:"")+'">\n\t\t\t\t\t<span class="title">'+s((u(l,"intlMessage")||t&&u(t,"intlMessage")||i).call(r,{name:"intlMessage",hash:{ownerName:null!=(a=null!=(a=null!=t?u(t,"gallery"):t)?u(a,"owner"):a)?u(a,"displayname"):a,intlName:"gallery.GALLERY_REMARK_OWNER_SAYS"},data:o,loc:{start:{line:22,column:25},end:{line:22,column:121}}}))+'</span>\n\t\t\t\t\t<span class="remark">'+s((u(l,"renderTrustedMarkup")||t&&u(t,"renderTrustedMarkup")||i).call(r,null!=t?u(t,"remark"):t,{name:"renderTrustedMarkup",hash:{},data:o,loc:{start:{line:23,column:26},end:{line:23,column:56}}}))+'</span>\n\t\t\t\t</div>\n\t\t\t</span>\n\t\t\t<div role="button" class="remark-button'+(null!=(a=u(l,"if").call(r,null!=t?u(t,"remark"):t,{name:"if",hash:{},fn:n.program(17,o,0),inverse:n.noop,data:o,loc:{start:{line:26,column:42},end:{line:26,column:71}}}))?a:"")+'" title="'+(null!=(a=u(l,"if").call(r,null!=t?u(t,"isGalleryOwner"):t,{name:"if",hash:{},fn:n.program(19,o,0),inverse:n.program(21,o,0),data:o,loc:{start:{line:26,column:80},end:{line:26,column:241}}}))?a:"")+'">\n\t\t\t\t<svg class="icon icon-remark hollow"><use xlink:href="#icon-remark"></use></svg>\n\t\t\t\t<svg class="icon icon-remark-filled filled"><use xlink:href="#icon-remark-filled"></use></svg>\n\t\t\t</div>\n\t\t</div>\n'},14:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"remark"):t,{name:"if",hash:{},fn:n.noop,inverse:n.program(15,o,0),data:o,loc:{start:{line:19,column:62},end:{line:19,column:90}}}))?a:""},15:function(n,t,l,e,o){return" hidden"},17:function(n,t,l,e,o){return" present"},19:function(n,t,l,e,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression((a(l,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"gallery.GALLERY_EDIT_REMARK_TOOLTIP"},data:o,loc:{start:{line:26,column:102},end:{line:26,column:164}}}))},21:function(n,t,l,e,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression((a(l,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"gallery.GALLERY_VIEW_REMARK_TOOLTIP"},data:o,loc:{start:{line:26,column:172},end:{line:26,column:234}}}))},23:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(l,"if").call(null!=t?t:n.nullContext||{},null!=(a=null!=(a=null!=(a=null!=t?r(t,"photo"):t)?r(a,"owner"):a)?r(a,"buddyicon"):a)?r(a,"default"):a,{name:"if",hash:{},fn:n.program(24,o,0),inverse:n.program(26,o,0),data:o,loc:{start:{line:36,column:3},end:{line:46,column:10}}}))?a:""},24:function(n,t,l,e,o){var a,r=n.lambda,i=n.escapeExpression,s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<a class="avatar person tiny"\n\t\t\t\t\tstyle="background-image: url('+i(r(null!=(a=null!=(a=null!=(a=null!=t?s(t,"photo"):t)?s(a,"owner"):a)?s(a,"buddyicon"):a)?s(a,"default"):a,t))+');"\n\t\t\t\t\thref="/photos/'+i(r(null!=(a=null!=(a=null!=t?s(t,"photo"):t)?s(a,"owner"):a)?s(a,"pathAlias"):a,t))+'/"\n\t\t\t\t\tdata-person-nsid="'+i(r(null!=(a=null!=(a=null!=t?s(t,"photo"):t)?s(a,"owner"):a)?s(a,"nsid"):a,t))+'"></a>\n'},26:function(n,t,l,e,o){var a,r=n.lambda,i=n.escapeExpression,s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<a class="avatar person tiny"\n\t\t\t\t\tstyle="background-image: url('+i(r(null!=(a=null!=(a=null!=t?s(t,"photo"):t)?s(a,"owner"):a)?s(a,"buddyicon"):a,t))+');"\n\t\t\t\t\thref="/photos/'+i(r(null!=(a=null!=(a=null!=t?s(t,"photo"):t)?s(a,"owner"):a)?s(a,"pathAlias"):a,t))+'/"\n\t\t\t\t\tdata-person-nsid="'+i(r(null!=(a=null!=(a=null!=t?s(t,"photo"):t)?s(a,"owner"):a)?s(a,"nsid"):a,t))+'"></a>\n'},28:function(n,t,l,e,o){var a,r,i=null!=t?t:n.nullContext||{},s=n.escapeExpression,u=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<a href="'+s("function"==typeof(r=null!=(r=u(l,"photoPageUrl")||(null!=t?u(t,"photoPageUrl"):t))?r:n.hooks.helperMissing)?r.call(i,{name:"photoPageUrl",hash:{},data:o,loc:{start:{line:50,column:13},end:{line:50,column:29}}}):r)+'" class="title" title="'+(null!=(a=u(l,"if").call(i,null!=(a=null!=t?u(t,"photo"):t)?u(a,"title"):a,{name:"if",hash:{},fn:n.program(29,o,0),inverse:n.program(31,o,0),data:o,loc:{start:{line:50,column:52},end:{line:50,column:143}}}))?a:"")+'" tabindex="-1">\n\t\t\t\t\t'+s(n.lambda(null!=(a=null!=t?u(t,"photo"):t)?u(a,"title"):a,t))+"\n\t\t\t\t</a>\n"},29:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression(n.lambda(null!=(a=null!=t?r(t,"photo"):t)?r(a,"title"):a,t))},31:function(n,t,l,e,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression((a(l,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.UNTITLED"},data:o,loc:{start:{line:50,column:94},end:{line:50,column:136}}}))},33:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<a href="'+n.escapeExpression(n.lambda(null!=(a=null!=(a=null!=t?r(t,"photo"):t)?r(a,"owner"):a)?r(a,"url"):a,t))+'" class="attribution">\n'+(null!=(a=(r(l,"photoAttribution")||t&&r(t,"photoAttribution")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},null!=t?r(t,"photo"):t,null!=t?r(t,"flippers"):t,{name:"photoAttribution",hash:{},fn:n.program(34,o,0),inverse:n.noop,data:o,loc:{start:{line:57,column:5},end:{line:63,column:26}}}))?a:"")+"\t\t\t\t</a>\n"},34:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"intlName"):t,{name:"if",hash:{},fn:n.program(35,o,0),inverse:n.program(37,o,0),data:o,loc:{start:{line:58,column:6},end:{line:62,column:13}}}))?a:""},35:function(n,t,l,e,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t\t\t\t\t"+n.escapeExpression((a(l,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{user:null!=t?a(t,"user"):t,intlName:null!=t?a(t,"intlName"):t},data:o,loc:{start:{line:59,column:7},end:{line:59,column:50}}}))+"\n"},37:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t\t\t\t\t"+n.escapeExpression("function"==typeof(a=null!=(a=r(l,"user")||(null!=t?r(t,"user"):t))?a:n.hooks.helperMissing)?a.call(null!=t?t:n.nullContext||{},{name:"user",hash:{},data:o,loc:{start:{line:61,column:7},end:{line:61,column:15}}}):a)+"\n"},39:function(n,t,l,e,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<span class="engagement-item like">\n\t\t\t\t\t'+n.escapeExpression((a(l,"outlet")||t&&a(t,"outlet")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},null!=t?a(t,"like-engagement-item-view"):t,{name:"outlet",hash:{},data:o,loc:{start:{line:72,column:5},end:{line:72,column:41}}}))+"\n\t\t\t\t</span>\n"},41:function(n,t,l,e,o){var a,r=null!=t?t:n.nullContext||{},i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<span role="button" class="engagement-item fave '+(null!=(a=i(l,"if").call(r,null!=(a=null!=(a=null!=t?i(t,"photo"):t)?i(a,"engagement"):a)?i(a,"isFaved"):a,{name:"if",hash:{},fn:n.program(42,o,0),inverse:n.noop,data:o,loc:{start:{line:75,column:52},end:{line:75,column:97}}}))?a:"")+(null!=(a=i(l,"if").call(r,null!=t?i(t,"canFave"):t,{name:"if",hash:{},fn:n.noop,inverse:n.program(44,o,0),data:o,loc:{start:{line:75,column:97},end:{line:75,column:132}}}))?a:"")+'" tabindex="0">\n\t\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t\t<i class="animated-fave-star"></i>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="engagement-count'+(null!=(a=i(l,"if").call(r,null!=(a=null!=(a=null!=t?i(t,"photo"):t)?i(a,"engagement"):a)?i(a,"faveCount"):a,{name:"if",hash:{},fn:n.noop,inverse:n.program(15,o,0),data:o,loc:{start:{line:79,column:34},end:{line:79,column:82}}}))?a:"")+'">\n\t\t\t\t\t\t'+(null!=(a=i(l,"if").call(r,null!=(a=null!=(a=null!=t?i(t,"photo"):t)?i(a,"engagement"):a)?i(a,"faveCount"):a,{name:"if",hash:{},fn:n.program(46,o,0),inverse:n.noop,data:o,loc:{start:{line:80,column:6},end:{line:80,column:90}}}))?a:"")+"\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n"},42:function(n,t,l,e,o){return" faved"},44:function(n,t,l,e,o){return" can-not-fave"},46:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression((r(l,"formatNumber")||t&&r(t,"formatNumber")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},null!=(a=null!=(a=null!=t?r(t,"photo"):t)?r(a,"engagement"):a)?r(a,"faveCount"):a,{name:"formatNumber",hash:{},data:o,loc:{start:{line:80,column:40},end:{line:80,column:83}}}))},48:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression((r(l,"formatNumber")||t&&r(t,"formatNumber")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},null!=(a=null!=(a=null!=t?r(t,"photo"):t)?r(a,"engagement"):a)?r(a,"commentCount"):a,{name:"formatNumber",hash:{},data:o,loc:{start:{line:89,column:42},end:{line:89,column:88}}}))},50:function(n,t,l,e,o){return'\t\t\t\t<span role="button" class="engagement-item curate" tabindex="0">\n\t\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t\t<svg class="icon icon-curate"><use xlink:href="#icon-curate"></use></svg>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n'},compiler:[8,">= 4.3.0"],main:function(n,t,l,e,o){var a,r,i=null!=t?t:n.nullContext||{},s=n.hooks.helperMissing,u=n.escapeExpression,c=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="photo-list-photo-container'+(null!=(a=c(l,"if").call(i,null!=t?c(t,"infoBarOnHover"):t,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.noop,data:o,loc:{start:{line:1,column:38},end:{line:1,column:85}}}))?a:"")+' loading">\n\t<div class="photo-container">\n\t\t<div class="photo'+(null!=(a=c(l,"if").call(i,null!=(a=null!=t?c(t,"photo"):t)?c(a,"needsInterstitial"):a,{name:"if",hash:{},fn:n.program(3,o,0),inverse:n.noop,data:o,loc:{start:{line:3,column:19},end:{line:3,column:74}}}))?a:"")+(null!=(a=c(l,"if").call(i,null!=(a=null!=t?c(t,"photo"):t)?c(a,"isVideo"):a,{name:"if",hash:{},fn:n.program(5,o,0),inverse:n.noop,data:o,loc:{start:{line:3,column:74},end:{line:3,column:111}}}))?a:"")+(null!=(a=c(l,"if").call(i,null!=t?c(t,"displayDescriptions"):t,{name:"if",hash:{},fn:n.program(7,o,0),inverse:n.noop,data:o,loc:{start:{line:3,column:111},end:{line:3,column:162}}}))?a:"")+'"></div>\n\t\t<a class="click-target" href="'+u("function"==typeof(r=null!=(r=c(l,"photoPageUrl")||(null!=t?c(t,"photoPageUrl"):t))?r:s)?r.call(i,{name:"photoPageUrl",hash:{},data:o,loc:{start:{line:4,column:32},end:{line:4,column:48}}}):r)+'" tabindex="0" role="heading" aria-level="3" aria-label="'+u(n.lambda(null!=(a=null!=t?c(t,"photo"):t)?c(a,"title"):a,t))+'"></a>\n\n'+(null!=(a=c(l,"if").call(i,null!=(a=null!=t?c(t,"photo"):t)?c(a,"isVideo"):a,{name:"if",hash:{},fn:n.program(9,o,0),inverse:n.noop,data:o,loc:{start:{line:6,column:2},end:{line:8,column:9}}}))?a:"")+"\n"+(null!=(a=c(l,"if").call(i,null!=t?c(t,"canRemovePhoto"):t,{name:"if",hash:{},fn:n.program(11,o,0),inverse:n.noop,data:o,loc:{start:{line:11,column:2},end:{line:17,column:9}}}))?a:"")+(null!=(a=c(l,"if").call(i,null!=t?c(t,"infoBarOnHover"):t,{name:"if",hash:{},fn:n.noop,inverse:n.program(13,o,0),data:o,loc:{start:{line:18,column:2},end:{line:31,column:9}}}))?a:"")+'\t</div>\n\t<div class="sub-photo-info-bar invisible">\n\t\t<div class="details-container">\n'+(null!=(a=c(l,"if").call(i,null!=t?c(t,"showOwnerIcon"):t,{name:"if",hash:{},fn:n.program(23,o,0),inverse:n.noop,data:o,loc:{start:{line:35,column:3},end:{line:47,column:10}}}))?a:"")+'\t\t\t<div class="details">\n'+(null!=(a=c(l,"if").call(i,null!=(a=null!=t?c(t,"photo"):t)?c(a,"title"):a,{name:"if",hash:{},fn:n.program(28,o,0),inverse:n.noop,data:o,loc:{start:{line:49,column:4},end:{line:53,column:11}}}))?a:"")+"\n"+(null!=(a=c(l,"if").call(i,null!=(a=null!=(a=null!=t?c(t,"photo"):t)?c(a,"owner"):a)?c(a,"displayname"):a,{name:"if",hash:{},fn:n.program(33,o,0),inverse:n.noop,data:o,loc:{start:{line:55,column:4},end:{line:65,column:11}}}))?a:"")+'\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="engagement">\n'+(null!=(a=(c(l,"isFlipped")||t&&c(t,"isFlipped")||s).call(i,"enable-likes",{name:"isFlipped",hash:{},fn:n.program(39,o,0),inverse:n.program(41,o,0),data:o,loc:{start:{line:70,column:3},end:{line:83,column:17}}}))?a:"")+'\t\t\t<span role="button" class="engagement-item comment" tabindex="0">\n\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t<svg class="icon icon-comment_hollow"><use xlink:href="#icon-comment_hollow"></use></svg>\n\t\t\t\t</span>\n\t\t\t\t<span class="engagement-count'+(null!=(a=c(l,"if").call(i,null!=(a=null!=(a=null!=t?c(t,"photo"):t)?c(a,"engagement"):a)?c(a,"commentCount"):a,{name:"if",hash:{},fn:n.noop,inverse:n.program(15,o,0),data:o,loc:{start:{line:88,column:33},end:{line:88,column:84}}}))?a:"")+'">\n\t\t\t\t\t'+(null!=(a=c(l,"if").call(i,null!=(a=null!=(a=null!=t?c(t,"photo"):t)?c(a,"engagement"):a)?c(a,"commentCount"):a,{name:"if",hash:{},fn:n.program(48,o,0),inverse:n.noop,data:o,loc:{start:{line:89,column:5},end:{line:89,column:95}}}))?a:"")+"\n\t\t\t\t</span>\n\t\t\t</span>\n"+(null!=(a=c(l,"if").call(i,null!=t?c(t,"displayCurate"):t,{name:"if",hash:{},fn:n.program(50,o,0),inverse:n.noop,data:o,loc:{start:{line:92,column:3},end:{line:98,column:10}}}))?a:"")+'\t\t</div>\n\n\t</div>\n\t<div class="remove-message-container hidden">\n\t\t<div class="remove-message-content">\n\t\t\t<span class="remove-text">'+u((c(l,"intlMessage")||t&&c(t,"intlMessage")||s).call(i,{name:"intlMessage",hash:{mediaType:null!=(a=null!=t?c(t,"photo"):t)?c(a,"mediaType"):a,intlName:"gallery.PHOTO_REMOVED"},data:o,loc:{start:{line:104,column:29},end:{line:104,column:104}}}))+'</span>\n\t\t\t<a role="button" class="remove-refresh-button">'+u((c(l,"intlMessage")||t&&c(t,"intlMessage")||s).call(i,{name:"intlMessage",hash:{intlName:"common.REFRESH"},data:o,loc:{start:{line:105,column:50},end:{line:105,column:91}}}))+"</a>\n\t\t</div>\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),e={};n.Array.each(["photo-card-overlay-icon"],(function(t){var l=n.Template.get("hermes/"+t);l&&(e[t]=l)})),n.Template.register("hermes/photo-list-gallery-photo-view",(function(t,o){return(o=o||{}).partials=o.partials?n.merge(e,o.partials):e,l(t,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-photo-card-overlay-icon"]});YUI.add("photo-list-gallery-photo-view",(function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.PhotoListSubview,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.photoModel=e.model,this.signedIn=this.appContext.getViewer().signedIn,e.subviewParams={"like-engagement-item-view":{photoId:this.get("id"),showCount:!0,size:"small",isPadded:!1,theme:this.params.infoBarOnHover?"light":void 0}}},subviewConfig:{"like-engagement-item-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-likes")}}},loadState:function(){return e.Promise.all([this.appContext.getModel("photo-engagement-models",this.get("id")).then(function(e){this.engagementModel=e}.bind(this)),this.appContext.getModel("gallery-info-models",this.params.galleryId).then(function(e){this.galleryInfoModel=e}.bind(this)),this.appContext.getModel("gallery-photo-models",this.params.galleryId+"-"+this.get("id")).then(function(e){this.galleryPhotoModel=e}.bind(this))])},buildContainer:function(){var t,i=e.URLHelper.getPhotoPage({photoId:this.get("model").getValue("id"),pathAlias:this.get("model").getValue("owner").getValue("pathAlias"),contextSuffix:this.params.contextSuffix}),n=this.get("model"),a=n.getValue("owner"),s=n.getValue("engagement"),o=this.galleryInfoModel.getValue("owner"),r={title:n.getValue("title"),isVideo:n.getValue("isVideo"),needsInterstitial:n.getValue("needsInterstitial"),mediaType:n.getValue("mediaType"),owner:{nsid:a.getValue("nsid"),buddyicon:a.getValue("buddyicon"),pathAlias:a.getValue("pathAlias"),displayname:a.getValue("displayname"),url:a.getValue("url")},engagement:{isFaved:s.getValue("isFaved"),faveCount:s.getValue("faveCount"),commentCount:s.getValue("commentCount"),canFave:s.getValue("canFave")}},d={owner:{displayname:o.getValue("displayname"),nsid:o.getValue("nsid")}};this.get("container");this.isGalleryOwner=this.signedIn&&this.appContext.getViewer().nsid===d.owner.nsid,t={photoPageUrl:i,photoUrl:this.get("photoUrl"),photo:r,infoBarOnHover:this.params.infoBarOnHover,showOwnerIcon:this.params.showOwnerIcon,canFave:this.signedIn&&r.engagement.canFave,canRemovePhoto:this.signedIn&&(this.appContext.getViewer().nsid===this.galleryInfoModel.getValue("owner").getValue("nsid")||this.appContext.getViewer().nsid===this.get("model").getValue("owner").getValue("id")),gallery:d,remark:this.galleryPhotoModel.getValue("remark"),isGalleryOwner:this.isGalleryOwner,displayCurate:this.signedIn},this.setContainerWithTemplate("photo-list-gallery-photo-view",t),this.updateGeometry()},activate:function(){var e=this,t=this.get("container");this.mainContainer=t.one(".photo-list-photo-container"),this.photoContainer=t.one(".photo-container"),this.infoBar=t.one(".sub-photo-info-bar"),this.infoBarEngagement=this.infoBar.one(".engagement"),this.faveNode=this.infoBar.one(".engagement-item.fave"),this.commentNode=this.infoBar.one(".engagement-item.comment"),this.detailsNode=this.infoBar.one(".details-container"),this.avatar=this.detailsNode.one(".avatar"),this.removeButtonContainer=t.one(".remove-x-container"),this.remarkContainer=t.one(".remark-container"),this.curateNode=this.infoBar.one(".engagement-item.curate"),this.curateNode&&this.registerEventHandler(this.curateNode.on(["click","keydown"],this.handleCurateClick.bind(this))),this.faveNode&&(this.faveCountNode=this.faveNode.one(".engagement-count")),this.removeButtonContainer&&(this.removeButton=this.removeButtonContainer.one(".remove-x-button"),this.removeMessageContainer=t.one(".remove-message-container"),this.removeMessageContent=this.removeMessageContainer.one(".remove-message-content"),this.removeRefreshButton=this.removeMessageContainer.one(".remove-refresh-button")),this.remarkContainer&&(this.remarkButton=this.remarkContainer.one(".remark-button"),this.remarkLineContainer=this.remarkContainer.one(".remark-line-container"),this.remarkLine=this.remarkContainer.one(".remark-line"),this.remarkTextNode=this.remarkLine.one(".remark"),this.remarkLineTitle=this.remarkLine.one(".title")),this.faveNode&&this.registerEventHandler(this.faveNode.on(["click","key"],this.handleFaveClick.bind(this),"down:13")),this.commentNode&&(this.commentIcon=this.commentNode.one(".engagement-icon"),this.commentTextNode=this.commentNode.one(".engagement-count"),this.registerEventHandler(this.commentNode.on(["click","key"],this.handleCommentClick.bind(this),"down:13"))),this.removeButtonContainer&&(this.registerEventHandler(this.removeButton.on(["click","key"],this.handleRemoveClick.bind(this),"down:13")),this.registerEventHandler(this.removeRefreshButton.on(["click","key"],this.handleRemoveRefreshClick.bind(this),"down:13"))),this.remarkButton&&this.registerEventHandler(this.remarkButton.on(["click","key"],this.handleRemarkClick.bind(this),"down:13")),this.registerEventHandler(this.galleryPhotoModel.on("valuesChanged",this.handleGalleryPhotoModelValuesChanged.bind(this))),this.registerEventHandler(this.engagementModel.on("valuesChanged",this.handleEngagementModelValuesChanged.bind(this))),this.downloadCacheAndSetImage(),this.appContext.flipper.isFlipped("enable-likes")?(this.likeNode=this.infoBarEngagement.one(".engagement-item.like"),this.likeView=this.subviews["like-engagement-item-view"],this.likeView.isActivated?this.setupBreakpointing():this.likeView.on("activated",(function(){e.setupBreakpointing()}))):this.setupBreakpointing(),this.infoBar.hasClass("invisible")&&this.infoBar.removeClass("invisible"),this.mainContainer.removeClass("loading")},setupBreakpointing:function(){e.UA.ie||this.appContext.getUA().isEdge?this.updateEdgeBreakpoints():(this.updateBreakpoints(),this.registerEventHandler(e.on("resize",e.betterThrottle(this.updateBreakpoints.bind(this),500,this,!0))))},handleFaveClick:function(t){var n,a=t.currentTarget,s=a.one(".engagement-count");this.faveNode.hasClass("can-not-fave")?this.signedIn||this.showSignUpAndFaveModal(this.get("model").getValue("id"),e.config.win.location.href):this.isFaving||(this.isFaving=!0,this.engagementModel.toggleFave(),n=this.engagementModel.getValue("faveCount"),a.toggleClass("faved",this.engagementModel.getValue("isFaved")),s.toggleClass("empty",0===n),s&&n>0?s.set("text",n):s.set("text",""),this.engagementModel.remoteUpdate().then(function(){this.isFaving=!1}.bind(this),function(e){3!==e.code&&(this.engagementModel.toggleFave(),a.toggleClass("faved",this.engagementModel.getValue("isFaved")),s&&(s.set("text",n),s.toggleClass("empty",0===n))),i.error("Error faving photo",{err:e}),this.isFaving=!1}.bind(this)))},handleCommentClick:function(){var t,i=this,n=new e.Views["photo-comments-view"]({appContext:this.appContext,photoId:this.get("model").getValue("id"),isScrollable:!0,addCommentText:this.intlMessage({intlName:"comments.ADD_PHOTO_COMMENT",mediaType:this.get("model").getValue("mediaType")})});t=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,preferTop:!0,width:400,height:400,newReposition:!0,autoSizeToContent:!0,anchorOffsetVertical:0,classList:"gallery-photo-remark",anchorElement:this.commentIcon,keyboardAnchorElement:this.commentNode,subview:n,contentPadding:0,preventPageScrollOnScroll:!0,useDefaultKeyboardNavigation:!1}),i.registerEventHandler(e.on("addComment:showingSignupModal",(function(){t.close()}))),t.on("closeDroparound",(function(){i.commentNode.removeClass("active"),i.infoBar.removeClass("active")})),t.show(),this.commentNode.addClass("active"),this.infoBar.addClass("active")},handleCurateClick:function(e){"click"!==e.type&&13!==e.keyCode&&32!==e.keyCode||(e.halt(),this.showAddToCuration())},showAddToCuration:function(){var t=this.get("model").getValue("isOwner");new e.CurationHelper(this.appContext,{view:this}).showAddToCuration({photoId:this.get("model").getValue("id"),showAlbums:t,showGalleries:!t,anchorNode:this.curateNode})},handleRemoveClick:function(){var t=this,i=new e.Views.FluidModal({title:this.intlMessage({intlName:"common.CONFIRMATION"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),textMessage:this.intlMessage({intlName:"gallery.ARE_YOU_SURE_REMOVE_PHOTO",mediaType:t.get("model").getValue("mediaType")}),appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelX:!1});i.show(),i.on("actionClick",(function(i){e.rapidTracker.beacon(t.name,"galleryPhotoRemoveConfirmClick"),t.removeMessageContainer.toggleClass("hidden",!1),e.fire("galleryPhotoList:deletePhoto",{photoId:t.get("model").getValue("id")})}))},handleRemarkClick:function(){var t=this,i=new e.Views["gallery-page-remark-view"]({galleryId:this.galleryInfoModel.getValue("id"),photoId:this.get("model").getValue("id"),appContext:this.appContext});e.rapidTracker.beacon(this.name,"galleryPhotoRemarkClick"),this.remarkContainer.addClass("active");var n=new e.Views.FluidDroparound({appContext:t.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,preferTop:!0,width:400,newReposition:!0,autoSizeToContent:!0,anchorOffsetVertical:0,classList:"gallery-photo-comments",anchorElement:t.remarkButton,keyboardAnchorElement:t.remarkButton,subview:i,contentPadding:0,preventPageScrollOnScroll:!0});n.show(),i.registerEventHandler(n.on("closeDroparound",(function(){t.remarkContainer.removeClass("active")}))),i.registerEventHandler(e.on("galleryPageRemark:reposition",(function(){n.repositionToElement(t.remarkButton)}))),i.registerEventHandler(e.on("galleryPageRemark:close",(function(){n.close()})))},handleGalleryPhotoModelValuesChanged:function(e){var t;e.remark&&(t=e.remark.newVal,this.remarkLine.toggleClass("hidden",!t),this.remarkTextNode.set("innerHTML",t),this.remarkContainer.toggleClass("present",t))},handleEngagementModelValuesChanged:function(t){var i;t.commentCount&&(i=t.commentCount.newVal,this.commentTextNode.set("text",e.IntlNumber.format(i,this.appContext.lang,1)),this.commentTextNode.toggleClass("hidden",0===i))},updateBreakpoints:function(){var e=0,t=this.infoBar.get("clientWidth");t>200||(this.infoBar.addClass("invisible"),this.infoBar.removeClass("narrow"),this.photoContainer.removeClass("narrow"),this.detailsNode.removeClass("hidden"),this.commentNode.removeClass("hidden"),this.curateNode&&this.curateNode.removeClass("hidden"),this.appContext.flipper.isFlipped("enable-likes")?this.likeNode&&(this.likeNode.removeClass("hidden"),this.likeNode.removeClass("last"),this.likeView.showCountNode(!0)):this.faveNode&&(this.faveNode.removeClass("hidden"),this.faveNode.removeClass("last"),this.faveCountNode.removeClass("hidden")),this.avatar&&this.avatar.removeClass("hidden"),this.remarkContainer&&(this.remarkContainer.addClass("invisible"),this.remarkContainer.removeClass("narrow"),this.remarkLineTitle.removeClass("hidden")),this.removeButtonContainer&&this.removeButtonContainer.addClass("invisible"),this.removeMessageContainer&&(this.removeMessageContainer.addClass("unhidden"),this.removeMessageContent.removeClass("hidden")),this.avatar&&this.detailsNode.get("clientWidth")<80&&this.avatar.addClass("hidden"),this.detailsNode.get("clientWidth")<=10&&(this.infoBar.addClass("narrow"),this.detailsNode.addClass("hidden")),t<this.infoBarEngagement.get("clientWidth")+16&&(this.commentNode.addClass("hidden"),this.appContext.flipper.isFlipped("enable-likes")?(this.curateNode?e=this.curateNode.get("clientWidth"):this.likeNode.addClass("last"),this.infoBar.get("clientWidth")<this.likeNode.get("clientWidth")+e+16&&this.likeView.showCountNode(!1),this.curateNode&&this.infoBar.get("clientWidth")<this.infoBarEngagement.get("clientWidth")+e+16&&(this.curateNode.addClass("hidden"),this.likeNode.addClass("last"))):(this.curateNode?e=this.curateNode.get("clientWidth"):this.faveNode.addClass("last"),this.faveCountNode&&this.infoBar.get("clientWidth")<this.faveNode.get("clientWidth")+e+16&&this.faveCountNode.addClass("hidden"),this.curateNode&&this.infoBar.get("clientWidth")<this.infoBarEngagement.get("clientWidth")+e+16&&(this.curateNode.addClass("hidden"),this.faveNode.addClass("last")))),this.remarkContainer&&this.remarkLineTitle.get("offsetWidth")+20>this.remarkLineContainer.get("clientWidth")&&(this.remarkLineTitle.addClass("hidden"),20>this.remarkLineContainer.get("clientWidth")&&this.remarkContainer.addClass("narrow")),this.removeMessageContainer&&this.removeMessageContainer.get("clientWidth")<this.removeMessageContent.get("clientWidth")+16&&this.removeMessageContent.addClass("hidden"),this.mainContainer.get("clientWidth")<48&&this.photoContainer.addClass("narrow"),this.infoBar.removeClass("invisible"),this.removeButtonContainer&&this.removeButtonContainer.removeClass("invisible"),this.remarkContainer&&this.remarkContainer.removeClass("invisible"),this.removeMessageContainer&&this.removeMessageContainer.removeClass("unhidden"))},updateEdgeBreakpoints:function(){this.cardWidth=this.get("layoutItem").geometry.width,this.remarkLineWidth=this.cardWidth-24-18,this.cardWidth>200||(this.infoBar.addClass("invisible"),this.infoBar.removeClass("narrow"),this.photoContainer.removeClass("narrow"),this.detailsNode.removeClass("hidden"),this.commentNode.removeClass("hidden"),this.appContext.flipper.isFlipped("enable-likes")?this.likeNode&&(this.likeNode.removeClass("hidden"),this.likeNode.removeClass("last"),this.likeView.showCountNode(!0)):this.faveNode&&(this.faveNode.removeClass("hidden"),this.faveNode.removeClass("last"),this.faveCountNode.removeClass("hidden")),this.avatar&&this.avatar.removeClass("hidden"),this.remarkContainer&&(this.remarkContainer.addClass("invisible"),this.remarkContainer.removeClass("narrow"),this.remarkLineTitle.removeClass("hidden")),this.removeButtonContainer&&this.removeButtonContainer.addClass("invisible"),this.removeMessageContainer&&(this.removeMessageContainer.addClass("unhidden"),this.removeMessageContent.removeClass("hidden")),this.avatar&&this.cardWidth<236&&this.avatar.addClass("hidden"),this.cardWidth<=90&&(this.infoBar.addClass("narrow"),this.detailsNode.addClass("hidden")),this.cardWidth<156&&(this.commentNode.addClass("hidden"),this.curateNode||this.faveNode.addClass("last")),this.cardWidth<186&&(this.commentNode.addClass("hidden"),this.appContext.flipper.isFlipped("enable-likes")?(this.curateNode||this.likeNode.addClass("last"),this.cardWidth<116&&(this.likeView.showCountNode(!1),this.likeNode.addClass("last"),this.curateNode&&this.curateNode.addClass("hidden"))):(this.curateNode||this.faveNode.addClass("last"),this.faveCountNode&&this.cardWidth<116&&(this.faveCountNode.addClass("hidden"),this.faveNode.addClass("last"),this.curateNode&&this.curateNode.addClass("hidden")))),this.remarkContainer&&this.cardWidth<120&&(this.remarkLineTitle.addClass("hidden"),20>this.remarkLineWidth&&this.remarkContainer.addClass("narrow")),this.removeMessageContainer&&this.cardWidth<150&&this.removeMessageContent.addClass("hidden"),this.cardWidth<48&&this.photoContainer.addClass("narrow"),this.infoBar.removeClass("invisible"),this.removeButtonContainer&&this.removeButtonContainer.removeClass("invisible"),this.remarkContainer&&this.remarkContainer.removeClass("invisible"),this.removeMessageContainer&&this.removeMessageContainer.removeClass("unhidden"))},showSignUpAndFaveModal:function(t,i){var n,a=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),s=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"});(n=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:a,signUpMessage:s,beaconPrefix:"fave"})).on("signUpClick",(function(n){e.SigninHelper.signUpPendingFave({id:t},{postLoginUrl:i})})),n.on("signInClick",(function(n){e.SigninHelper.addPendingFave({id:t},{postLoginUrl:i})})),n.show()},handleRemoveRefreshClick:function(){e.fire("galleryPhotoList:refreshPhotoList")},downloadCacheAndSetImage:function(){e.fluid.loadImage(this.get("photoUrl"),{timeout:1e3,retry:!0}).then(function(e){this.handleImageLoad(!0,e)}.bind(this),function(e){this.handleImageLoad(!1,e+"?retry="+Date.now())}.bind(this))},handleImageLoad:function(t,i){var n=this.get("container").one(".photo");n.setStyle("backgroundImage","url("+i+")"),t||n.setStyle("backgroundColor","#eee"),e.fluid.chill((function(){this.fire(t?"loaded":"loadError")}),this),n=null}})}),"@VERSION@",{requires:["photo-list-subview","gallery-comments-view","photo-comments-view","gallery-page-remark-view","add-to-stuff-view","hermes-template-photo-list-gallery-photo-view","curation-helper"],optionalRequires:["hermes-core"],langBundles:["common","gallery","fave-view","comments"]});